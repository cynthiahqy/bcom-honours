---
title: "ECOM40007: Econometrics of Markets and Competition"
author: "Cynthia Huang"
date: "10/23/2016"
output: pdf_document
toc: true
number_sections: true
header-includes:
   \usepackage{bm}
   \usepackage{color}
   \usepackage{multirow,array}
   \usepackage[english]{babel}
graphics: yes
geometry: margin=0.6in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
###### 
\everymath{\displaystyle}

\newcommand{\sideimage}[2]{\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=1\linewidth]{#1}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=1\linewidth]{#2}
\end{minipage}
\end{figure}}

\newcommand{\image}[3]{
\begin{figure}
\centering
\includegraphics[width=#2\linewidth]{#1}
\caption{#3 (#1)}
\end{figure}
}

\newcommand{\LRA}{\Leftrightarrow}
\newcommand{\gam}{\gamma}
\newcommand{\tildeB}{\tilde{\B}}
\newcommand{\tcite}[1]{(#1)}
\newcommand{\abs}[1]{\lvert #1 \lvert}
\newcommand{\undersetbrace}[2]{\underset{#1}{\underbrace{#2}}}
\newcommand{\undersetbracetext}[2]{\underset{\text{#1}}{\underbrace{#2}}}
\newcommand{\sig}{\sigma}
\newcommand{\TK}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\pd}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\A}{\alpha}
\newcommand{\B}{\beta}
\newcommand{\pElasD}{\eta}
\newcommand{\eps}{\epsilon}
\newcommand{\Dshock}{\eps^D}
\newcommand{\Sshock}{\eps^S}
\newcommand{\Dq}{q^D}
\newcommand{\Sq}{q^S}
\newcommand{\IT}{\intertext}

\newcommand{\Yvec}{\bm{Y}}
\newcommand{\Zvec}{\bm{Z}}
\newcommand{\Wvec}{\bm{W}}
\newcommand{\Xvec}{\bm{X}}
\newcommand{\Bvec}{\bm{\B}}
\newcommand{\xvec}{\bm{x}}

   \setlength{\abovedisplayskip}{0pt}
   \setlength{\belowdisplayskip}{0pt}
   \setlength{\abovedisplayshortskip}{0pt}
   \setlength{\belowdisplayshortskip}{0pt}
\newpage

# L1: Introduction

### Background Knowledge

Micro theory |Econometrics
-------------|-------------------------
Nash eqlbm   | OLS
SPNE         | 2SLS
Bertrand     | IVs
Cournot      | Maximum Likelihood
Monopoly     | Inference/Std errors
Collusion    | basic probability theory 
Prod. fncs   | (PDF, CDF, conditional exp, covariance)

### Structural vs. Reduced-Form

-|Structural              | Reduced Form
-|----------------------- |--------------------------
-|Start w/ Theory         |Identify causality w/o theory
Pro:| clear eco. model  |no judgement calls
Con:| realistic?        |what are the economic forces?

## Generic Approach to Structural Econometrics
### Market definition 
- References: Davis and Garces, Chapter 4, provides a uniquely exhaustive
discussion of market definition
- Important in anti-trust cases
- Academic lit often takes mkt def as given (e.g. in theoretical models)

### Datasets

 Industry|Market|Individual|Big-Data
 ---------------|--------------|---------------|-----------|
 multi-industry time panel|single industry, multi market, time panel|firm panel data, cross-sectional individual, annual freq.| high-freq. firm & individual|

### Approach

1. Model
     a) Theory
     b) Data
     c) Theory too rigid for Data (no randomness), so build in shocks/unobservables
2. Identification 
3. Estimation

### Identification

* Assume infinte sample, not finite-sample issues
* For given eco model:
     + required variables, econometric assumptions to get model parameters
* For given dataset:
     + what is the richest model that can be identified? 
     + richer datasets = richer models
     + poor datasets = large std.error on richer model parameters

*****

# L2: Perfect Competition
#### Recommended Reading:  
Reiss and Wolak (2005), pages 1-24

## PC Demand and Supply Structual Estimation
### 1. Theory: PC Model Primitives


- Many price taking firms
- Homogenous good, free entry/exit, perfect info, no externalities, no transaction costs
- Walrasian eqlbm concept $q^D = q^S$
- Structural parameters: $\A$ and $\B$ are "deep" primitives
- Linear Demand & Supply
\begin{align*}
q^D &= \A_0 + \A_1 p + \A_2 x \\
p &= \B_0 + \B_1 q^S + \B_2 w \\
q^S &= \frac{1}{\B_1} (p - \B_0 - \B_2 w) \\
\pElasD &= \pd{q^D(p)}{p} \frac{p}{q} = \A_1 \frac{p}{q}
\end{align*}

### 2. Data 
* m=1:M markets cross-section, or t=1:T single market cross-section
* ___Endogenous___ variables 
     + $\{p,q\}$ observed prices and quantities of a single good
* ___Exogenous___ variables
    + $x$ = demand shifters (income, age, etc.)
    + $w$ = supply shifters (input costs, regulation)
* Assume endog are generated by PC model, estimate structural parameters


### 3. Rationalising Data with Unobservables
* ___Problem___: observe mkts with same $\{p,q\}$ but different $\{x,w\}$ or vice-versa
* ___Solution___: 
      a) vary structural parameters by market, but cannot estimate since no. of parameter vector = data points \TK{L2, s.16}
      b) use __Unobservables__: i.i.d., mean-zero demand and supply shocks $\{\Dshock,\Sshock\}$
              + Single Market demand, with structural errors $\{ \Dshock_m , \Sshock_m \}$
                 \begin{align*}
                 \Dq_m &= \A_0 + \A_1 p_m + \A_2 x_m + \Dshock_m \\
                 p_m &= \B_0 + \B_1 \Sq_m + \B_2 w_m + \Sshock_m \\
                 \end{align*}
 
### 2. Identification of slopes $\A_1, \B_1$                  
#### 2a) OLS Bias
- Simultaneity Bias:
      * D & S simultaneously determine observed $p,q$

- Endogeneity:
      * $p$ is correlated with the error term, because of joint supply and demand effects

- Identification issues:
      * Identifying assumption for $\A_1$ is $E[\Dshock_m p_m] = 0$
      * But OLS est of $\A_1$ is biased because:
          + any increase in $\Dshock$ shifts demand curve
          + demand shift = movement along supply = change in eqlbm $p$
          + $p$ and $\Dshock$ are positively correlated $E[\Dshock_m p_m] > 0$
          + violates identifying assumption for $\A_1$
      * Similarly identifying assumption for $\B_1$ is also violated.

___OLS interpretation___

$\gamma_{1}$ is correlation btwn $p_m$ and $q_m$, given by the intersection of D and S, BUT is not the slope of D or S, since it depends on both $\A_1$ and $\B_1$.
\begin{align*}
 q_m &= \gamma_{0} + \gamma_{1}p_m + \gamma_{2}[x_m w_m]' + v_m\\
\end{align*}

___Reduced form___ \
 $\gamma$ represents conditional correlations, but are not useful for policy evaluation 
 \begin{align*}
   p_m &= \gamma_{0a} + \gamma_{1a}x_m + \gamma_{2a}w_m + u_m \\
 q_m &= \gamma_{0b} + \gamma_{1b}x_m + \gamma_{2b}w_m + v_m
 \end{align*}

\TK{$\gamma_{1} > \alpha_1$, direction of bias}

#### 2b) Thought  Experiment (AB testing)
* m=1:M markets, exog demand shifters $x$, each mkt with 100 customers

___Demand Experiment:___

+ choose random price for each market m, 
+ have customers raise hand for purchase
+ record "demand" for each market

Identifying assumption $E[\Dshock_m p_m] = 0$ holds with this pure randomisation of prices, without any supply response
    + can use OLS: 
    $\Dq_m = \A_{0} + \A_{1} p_m + \A_{2}x_m  + \Dshock_m$
    + $\A_1$ is unbiased
    
 ___Supply Experiment:___
 
 * Similarly for supply, have sellers raise hand if willing to sell at random price
 * Identifying assumption $E[\Sshock_m p_m] = 0$ holds with this pure randomisation of prices, without any demand response
     + $\B_1$ is unbiased under OLS
 
#### 2c) Instrumental Variables (Field Method)
* Excluded demand shifters create random variation in demand independent of supply
    + use demand shifter not in supply eqn
    + denote excluded exogenous D shifter as $\tilde{x}$
    + $\tilde{x}$ is used to "instrument for" market prices; i.e. randomly change market prices using demand shocks
* Use demand shifters as instruments for supply
* Use supply shifters as instruments for demand

___Exclusion Restrictions for IV___

* Demand estimation: one supply shifter must be excluded from the demand function 
     + one element of $w$ does not belong to $x$
* Supply estimation: one demand shifter must be excluded from the supply function 
     + one element of $x$ does not belong to $w$

\sideimage{EMC-L02-S29.jpg}{EMC-L02-S32.jpg}
     
### 3. Estimation by 2SLS
* Stage 1: OLS
     + $\hat{p_m} = \hat{\gamma}_{OLS,0} + \hat{\gamma}_{OLS,1} w_m + \hat{\gamma}_{OLS,2} x_m$
     + $\hat{\gamma}_{OLS,1} > 0$ only holds if $w$ is not equal to or a subset of $x$
         - conditional on other covariates $x$, there remains some correlation btwn $w$ and $p$
         - if correlation is weak then have "weak instruments problem", results in large std.errors for $\A_1$ and $\B_1$
* Stage 2: Estimate $\A$ using $\hat{p}$ instead of $p$
     + Get estimates using variation in $\hat{p}$, but make predictions and calculate var-cov weighting using $p$
   
\newcommand{\Biv}{\B_{IV}}  
General regression:
\begin{align*}
y_m &= x\B + \eps \\
&= x_1 \B_1 + x_2 \B_2 + \eps\\
\intertext{Let $x_1$ be potentially endogenous, $x_2$ are exogenous}
x &= [x_1 \quad x_2], \ \B = [\B_1' \B_2']'\\
\intertext{Let $w$ be IV's excluded from demand function (regression eqn), combine with $x_2$ for exogenous regressors $z = [w \ x_2]$, where $rank(z) \geq rank(x)$}
\Biv &= (x'z(z'z)^{-1}z'x)^{-1} (x'z(z'z)^{-1}z'y) \\
&= (x'P_zx)^{-1}(x'P_zy)
\end{align*}
     
## Summary of Assumptions
* Linear demand and supply equations with $\alpha$ and $\beta$ parameters that are common to all markets
* Eqlbm: D = S
* Exclusion restrictions: 
    + (1) at least one element of $w$ is not included in the demand equation; 
    + (2) at least one element of $x$ is not included in the supply equation
* Statisical assumption of exogeneity:
    + $x$ is uncorrelated with $\Dshock$ and $\Sshock$
    + $w$ is uncorrelated with $\Dshock$ and $\Sshock$
    + $\Dshock$ and $\Sshock$ are uncorrelated

\TK{Relationship btwn exclusion restriction and exogeneity assumption}

## Policy Experiments
* Introduce price floor $\underbar{p}$
* Assume no impact on structural parameters (no re-estimation)
    + able to predict effect of price floor on quantities
    + can also evaluate CS and PS
    
## Extension: Heterogeneity
Heterogeneity across markets:

* cross-sectional data cannot be used to identify market-specific demand curves
     + too many parameters (e.g. solution to rationalisation)
* panel data can be used to identify market-specific demand curves using variation over time. 
     + more time periods allow for more market-specific parameters
     + usually allow for mkt intercepts (mkt level fixed effects $\A_0^m, \B_0^m$), but common slopes
\begin{align*}
 \Dq_{mt} &= \A_0^m + \A_1 p_{mt} + \A_2 x_{mt} + \Dshock_{mt} \\
 p_{mt} &= \B_0^m + \B_1 \Sq_{mt} + \B_2 w_{mt} + \Sshock_{mt} 
\end{align*}
    
***
# L3: Homogenous Product Markets
#### Recommended reading: 

- Reiss and Wolak (2005) Sections 6, p.49-59,
- Davis and Garces Chapter 4, Chapter 6 p. 305-315,
- Bresnahan (1982): 
      * Identifying conduct & marginal costs
      * shows empirical estimation of conduct & MCs in homogenous goods markets
      * finds excluded demand and supply shifters are insufficient to identify conduct and MCs
- Genesove and Mullin (1998) -- \TK{ASSIGNMENT 1}

## 1. Theory: Conjectural Variation Model
### 1a  Heterogenous Costs
\begin{align*}
\intertext{$N$ firms, homogenous good, static competition (period by period). Firm $i$'s profit maximisation with hetero costs:}
\underset{q_i}{\max}& P(Q)q_i - c_i(q_i) \\
P(Q) &\equiv \text{inverse market demand} \\
Q &\equiv \sum_{n=1}^{N} q_n \\
c_i(q_i) &\equiv \text{firm $i$'s cost function at $q_i$} \\
\intertext{FOC wrt $q_i$}
P(Q) + \pd{P(Q)}{q_i}q_i - \pd{c_i(q_i)}{q_i} &= 0 \\
%\intertext{strategic interaction $\pd{q_j}{q_i}$ and FOC}
\pd{P(Q)}{q_i}&=  \pd{P(Q)}{Q} \pd{Q}{q_i}\\
&=\pd{P}{Q}  \pd{\sum_{n=1}^{N} q_n}{q_i} \\
&=
\underset{ \text{price effect times own price factor, and sum of cross price strategic interactions} }{\pd{P}{Q} [ 1 + \sum_{j \ne i} \pd{q_j}{q_i}] \quad \because \pd{q_i}{q_i} = 1} 
%\intertext{}
\\ 0 &= P(Q) + q_i\pd{P}{Q} [ 1 + \sum_{j \ne i} \pd{q_j}{q_i}] - \pd{c_i}{q_i} \\
\LRA \ & P(Q) + \theta_i q_i \pd{P}{Q} = MC
\\ &= \underset{ \text{intial price, strategic q effect, MC} }{P(Q) + q_i\pd{P}{Q} [ 1 + \sum_{j \ne i} \pd{q_j}{q_i}] - \pd{c_i}{q_i}}
\\ \theta_{ij} &\equiv \pd{q_j}{q_i}, \quad MC_i \equiv \pd{c_i}{q_i}, \quad \theta_i \equiv 1+ \sum_{j \ne i}\theta_{ij}
\\ &= \overset{\text{divide all by P(Q), times Q/Q}}{\frac{q_i}{Q} \frac{Q}{P(Q)} \pd{P(Q)}{Q} (1+ \sum_{j \ne i}\theta_{ij}) + \frac{P(Q)-MC_i}{P(Q)}}
\\ &= \underset{\text{$i$'s market share, inverse elast. demand, i's conjeture about other firms reaction to $q_i$, markup/Lerner Index}}{s_i \cdot {\frac{1}{\eta}} \cdot {\theta_{i}} + {\frac{P(Q)-MC_i}{P(Q)}}}
\\ \text{FOC } \LRA \ & \frac{P(Q)-MC_i}{P(Q)} = \frac{s_i}{\eta}\theta_i
\end{align*}

* Cross-effects: $\pd{q_j}{q_i} < 0$  
     + When firm $i$ increases quantity, optimal eqlbm response of $j$ is to decrease; magnitude depends of relative cost functions
* Conduct:
     + $\theta_i = 0$: Perfect Competition
     + $\theta_i \in (0,1)$: Oligopoly
         - depends on relative $MC_i$ for $i=1:N$; conjecture about other firms response
     + $\theta_i = 1, \ s_i = 1$: Monopoly

___Aggregation___

* Aggregation of inidividual firms to market-level supply results in similar interpretation of $\theta$ under both hetero and homo costs. 
     + Homo cost or aggregate hetero costs: $\theta$ is average collusiveness
     + Individual hetero costs: $\theta_i$ is firm i's conjecture about other firms response to $q_i$
     + \TK{Aggregate sample averages, or average moments}
     
\begin{align*}
\intertext{Individual F.O.C}
P(Q) + \frac{1}{N} \sum_{n=1}^N \theta_i q_i \pd{P}{Q} &= \frac{1}{N} \sum_{n=1}^N MC_i 
\intertext{Average over N firms}
\underset{\text{times Q/Q, with avg}}{P(Q) + \theta \pd{P}{Q}Q} &= MC
\\ \theta \equiv \frac{1}{N} \sum_{n=1}^N \theta_i q_i \frac{1}{Q}, & \quad MC \equiv \frac{1}{N} \sum_{n=1}^N MC_i
\intertext{D eqn}
Q &= \A_0 + \A_1 P + \A_2 x + \Dshock
\intertext{MC of firm $i$}
MC_i &= \B_0 + \B_1 q_i + \B_2 w_i + \Sshock_i
\intertext{Avg over N firms, $\textstyle{\tilde{\B_1} \equiv  \frac{\B_1}{N}} $}
MC &= \B_0 + \B_1 \frac{Q}{N} + \B_2 \frac{1}{N}  \sum_{n=1}^N w_i + \frac{1}{N} \sum_{n=1}^N \Sshock_i
\\ MC &= \B_0 + \tilde{\B_1}Q + \B_2 w + \Sshock 
\end{align*}

\ |$>0$|$<0$|$0$ 
--|:------:|:------:|:------:
$\B_1$| convex prod. fnc | concave | linear CRS
\ |decreasing MC|increasing MC|constant MC

### 1b Homogenous costs 

|        |   Monopoly $q= Q$       | Cournot eqlbm $q = \frac{Q}{N}$ | Perfect Competition|
|:---------:|--------------------:|:------------------:|:------------------:|
|Pricing eqn|$P(Q) + Q \pd{P}{Q} = MC$|$P(Q) + \frac{Q}{N} \pd{P}{Q} = MC$ |$P(Q) = MC$|
|$\theta$   |1                        |$\theta \in (0,1)$                  |$\theta =0$|

$MC_i = MC, q_i = q, \theta_i = \theta, q = \frac{Q}{N}$ \
$P(Q) + \theta q \pd{P}{Q} = MC$  
For symmetric cournot: $\theta = \frac{1}{N}$


<!-- \begin{align*} -->
<!-- \intertext{$q_i = q, \theta_i = \theta, q = \frac{Q}{N}$} -->
<!--  P(Q) + \theta q \pd{P}{Q} &= MC  -->
<!-- \intertext{Monopoly $q= Q$} -->
<!--  P(Q) + Q \pd{P}{Q} &= MC &\Rightarrow \theta=1  -->
<!-- \intertext{Cournot eqlbm $q = \frac{Q}{N}$} -->
<!--  P(Q) + \frac{Q}{N} \pd{P}{Q} &= MC &\Rightarrow \theta = \frac{1}{N} -->
<!-- \intertext{Perfect Competition} -->
<!--  P(Q) &= MC &\Rightarrow \theta = 0 -->
<!-- \end{align*} -->

## 2. Identification
### Individual firm w/ Heterogenous costs
Oligopolist's pricing eqn depends on unknown $\theta_i$, and $MC_i$
\begin{gather*}
\frac{P(Q)-MC_i}{P(Q)} = \frac{s_i}{\eta}\theta_i
\end{gather*}
Imagine we have data on $P, q_i, Q$, can work out $s_i = \frac{q_i}{Q}$. \
Work with panel data, M markets over T periods ($P_mt, Q_mt$) \
Adding exog. demand and cost shifters $x, w$, can estimate $\eta$ from demand curve. \
However, without cost data, MC is difficult to estimate; hence $\theta_i$ is also difficult to estimate.

### Demand and Supply
\begin{align*}
\intertext{1. Estimate Demand Eqn, using excluded supply IV's from $w$ to instrument for $P$}
Q &= \A_0 + \A_1 P + \A_2 x + \Dshock
\intertext{2. Estimate Suppy Eqn, using $\pd{P}{Q} = \frac{1}{\hat{\A_1}}$ from 1. Demand estimation}
P(Q) + \theta \pd{P}{Q}Q &= \underset{MC}{\B_0 + \tilde{\B_1}Q + \B_2 w + \Sshock}
\\ P(Q) &= \B_0 + \underset{\gam}{\left[  \tilde{\B_1} - \frac{\theta}{\hat{\A}} \right]} Q + \B_2 w + \Sshock
\end{align*}

### Identification Problem

* Low prices depend on both low marginal costs, and strong competition: 
* $\gam$ depends on both $\tildeB_1$, and $\frac{\theta}{\hat{\A}}$
* Excluded demand shifters (supply IV's) can be used to identify $\gam$ but not to partial further

\TK{L03-S20-21}

#### Solution

a) Using institutional/market details
    + Assume CRS, so $\tildeB_1$ is 0, and $\gam = \frac{\theta}{\hat{\A}}$
    + Impose restrictions on $\theta$, to get $\tildeB_1 = \gam + \frac{\theta}{\hat{\A}}$
b) Using cost data to directly measure MC
    + can directly estimate $\B_1$ and $\tildeB_1$, to get $\frac{\theta}{\hat{\A}} = \tildeB_1 - \gam$
    + \tcite{Genesove and Mullin, 2008}
c) Use variation in **slope** of demand curve, not just position
    + find variables $s$ ($z$ in slides), that affects sensitivity to prices ($\gam = \pd{P(Q)}{Q}$)
    + uses demand data (e.g. avg income changes, seasonality etc), easier to access than supply data
    + \tcite{Bresnahan (1982)}

##### Intuition for c) Bresnahan (1982)

Market supply eqn
\begin{align*}
P(Q) &= MC + \underset{\text{mark up}}{\theta Q \lvert \pd{P(Q)}{Q} \lvert}
\\ \gamma &= \pd{P(Q)}{Q} = \tilde{\B_1} - \frac{\theta}{\hat{\A}}
\end{align*}

Demand rotation changes ($\pd{P(Q)}{Q}$):

 $\theta$| 1 | $\theta \in (0,1)$ | $\theta =0$
 ---------|:----------------------:|:------------------:|:---------------------:
 P change | mark-up increases, change in eqlbm | mark-up increases slower | no change in eqlbm price
 \ |Monopoly | Cournot eqlbm | Perfect Competition

 \sideimage{EMC-L03-S26.jpg}{EMC-L03-S25.jpg}

## 3. Implementation
\begin{align*}
\intertext{1. Estimate Demand w/ shifters $x$ and rotators $s$, using 2SLS with excluded supply shifters $w$ instruments for P}
Q &= \A_0 + (\A_{11} + \A_{12}s)P + \A_3 x + \Dshock
\intertext{2. Estimate Suppy eqn using excluded demand shifters and rotators to instrument for $Q$ and $\tilde{w}$}
P &= \B_0 + \left[  \tilde{\B_1} - \frac{\theta}{\hat{\A}_{11} + \hat{\A}_{12}z} \right] Q + \B_2 w + \Sshock \\
&= \B_0 + \tilde{\B_1}Q - \theta \underset{\tilde{w}}{\frac{Q}{\hat{\A}_{11} + \hat{\A}_{12}z} + \B_2 w + \Sshock} 
\\ &= \B_0 + \tilde{\B_1}Q - \theta \tilde{w} + \B_2 w + \Sshock
\intertext{3. Back out MC}
MC &= P(Q) + \theta \pd{P}{Q} Q
\\ \hat{MC} &= P(Q) + \frac{\hat{\theta}}{\hat{\A}_{11} + \hat{\A}_{12}z} Q
\intertext{4. Measure market power}
L &= \frac{P-MC}{P}
\end{align*}

## Policy Evaluation with Market Power
* Consider merger, new products, taxes, min. wages
* However, policy prescriptions are limited by structural assumptions, and suitability of model for industry
     + why linear d & s? (could be quadratic, log-lin, iso-elastic)
     + misses heterogenity of individual preferences, firms and product differences

# A1: Conduct in the Sugar Industry (Genesove and Mullin (1998))
Reference: Genesove, D., and W.P. Mullin (1998): “Testing Static Oligopoly Models: Conduct and Cost in the
Sugar Industry, 1890-1914,” Rand Journal of Economics, vol. 29, p. 355-377.

* Goal: Validate the "New Empirical Industrial Organisation" technique of using demand to identify conduct and cost, with an assumption of static oligopoly behaviour
* Method: 
     - benchmark by directly estimate MC using cost data and conduct information
     - estimate supply using demand variation \tcite(Bresnahan, 1989), invert mcs in static oligopoly model
     - compare model predictions to actual estimates
* Results: 
     - more competitive models yield better results, MC most closely matchs when conduct parameter is unrestricted
     - method is validated, but partial cost information can improve precision
     - results are robust to demand func

### Data: Comparison

U.S East Coast Cane Sugar Refining Industry

- changes in degree of competition: can estimate model under different structural conditions
       - compute conduct using MCs, and compare
- cost structure is known: confidence in structural form of MC
       - Refined sugar = x * raw sugar
       - x: fixed coefficient
       - compute MCs using assumed or unassumed conduct parameters, and compare with MC from data

### Model: Static Oligopoly Theory
\begin{align*}
    P + \undersetbracetext{mark-up}{\theta Q P'(Q)} &= c  \tag{1} \label{olieqn}
\\ P &: \text{eqlbm oligopoly price}
\\ Q &: \text{eqblm oligopoly quantity}
\\ \theta &: \text{conduct parameter} 
\intertext{$\theta$ is estimated freely with demand rotations in Bresnahan 1989, or can be assumed if only have proportional demand shifts}
\end{align*}

* Limitations:
     - widespread model; often used to examine policy questions
     - strong-functional form assumptions on demand; which imply stronger assumptions on price-MC relationship
     - mismeasures conduct under dynamic oligopoly (Corts)
* Assumptions:
     - Industry level data only, so can only talk about average behaviour
     - $c$ is the (unweighted) average MC

#### Direct estimation of Conduct w/ cost data
  \begin{align*}
     \theta &= \eta(P) \frac{P-c}P \equiv L_{\eta} \tag{2} \label{directconduct}
  \\ \eta(P) &: \text{price elasticity of demand}
  \\ L_{\eta} &: \text{elasticity adjusted Lerner Index}
  \end{align*}

$L_{\eta}$ is averaged over time to get average level of mkt power

- valid indicator of overall divergence of price from MC, normalised by elasticity, regardless of structural interpretation 
- behavioural interpretation: "average collusiveness of conduct"
- EXAMPLE: if behaviour oscillated btwn PC and Monopoly in alternating periods: $L_{\eta} = 0.5$, but that doesn't imply every period was Cournot

#### Identification of Conduct w/o cost data

- use Bresnahan (1989)'s method, which uses demand shifts and rotations
- IN practice:
      - non-linear IV estimation of \eqref{olieqn}
      - relates output price (refined sugar) to raw sugar price (input), seasonal dummy, and Cuba imports
      - \TK{requires restriction on stochastic behaviour of $\theta$, page 375}
      - BUT overly restrictive so allow $\theta$ to vary, as long as it is uncorrelated with instruments used to identify \eqref{olieqn}
- Corts Critique Recast:
     - In dynamic oligopoly, $\theta$ is correlated with instruemnts of seasonal dummy, and Cuban imports, which drive \TK{input price (raw sugar)}
     - Therefore Bresnahan method returns biased estimate of mean conduct parameters
     
#### Estimation of production fnc

\begin{align*}
\intertext{Constant MC of sugar refining, from simple and commonl used technology}
    c &= c_0 + k * P_{raw}
\intertext{100 pounds of raw sugar yielded 92.5-93 pound of refined sugar; constant throughout sample period and beyond}
    k &= 1.075 
\text{$c_0$ is all other variable costs, 26c is best estiamte, 16c lower}
    c_0 = \{0.16, 0.26\}
\end{align*}

#### Estimation of Demand

Prices: Willett and Gray's *Weekly Statistical Sugar Trade Journal*
Quantity: using production rather than consumption figures. There will be some lags due to inventorying etc, but production is a reasonable proxy given inventorying was avoided due to deterioration concerns

##### 1. Frequency of data
- Have weekly data but choose to use quarterly data
- weekly data gives additional degrees of freedom, however higher serial correlation
- more frequent data, increases likelihood of estimating misleadingly low elasticity of demand (demand doesn't change much in ultra SR)
       - with grocer or consumer switching costs, SR elasticity lower than LR
       - use of SR elasticity leads to higher monopoly price than forward looking monopolist would choose, imply lower mkt power by $L_\eta$
- estimates are similar for monthly and quarterly data
  
##### 2. Choice of Instruments
- $P_{Raw}$ not used to instrument price 
      - US was 25% of world consumption, too large for raw price as uncorrelated with US consumption (demand) shocks, which would flow into input market
- *Cuban imports* of raw sugar used to instrument \TK{for variation in input}
      - Most cuban sugar was exported to US, but made up a smaller, variable percentage of US sugar imports
      - *Cuban imports* were inframarginal source of raw sugar for US, in the SR, and exogenous to US demand
- In the SR, high switching costs meant that even for low realisations of US demand, Cuban imports were unlikely to redirected to more profitable markets (London was the next best market, but shipping costs were signficantl higher than to New York)
      - SR exogeneity could be violated if Cuban suppliers stock-piled during negative demand shocks in anticipation of higher prices next period (i.e. speculative storage in Cuba). However, if storage occured in US, then *Cuban Imports* remain exogenous to shocks. Aruge any storage would occur post export
- In the LR, variation in cuban sugar production (and imports) depended on clearly exogenous factors like harvest cycles, climate, war, and potentially endogenous factors such as planting of sugar cane. 
      - Plantings could be in response to growing U.S. demand (and prices); and any planting that was in (correct) anticipation of US demand will introduce correlation between *Cuban imports* and demand shocks. 
      - argue resulting bias will not be significant
 
###### 3. Demand function
- NEIO studies typically use linear or log-linear
- Restricts monopoly pricing rules:
      - e.g. Log-Linear: $p^M(c)$ is proportional to $MC$, every dollar increase in MC results in 50c increase in monopoly price
- Therefore, use estimates from a range of functional forms as comparison to direct estimates

\begin{align*}
\intertext{General Form of Demand Curve}
   Q(P) &= \B(\A - P)^{\gam}
\\ P &: \text{price of refined sugar}
\\ \B &: \text{size of mkt demand}
\\ \gam &: \text{index of convexity}
\\ \A &: \text{maximum willingness to pay if $\gam > 0$}
\\ \text{quadratic D curve} &: \gam=2
\\ \text{linear D curve} &: \gam=1
\\ \text{log-lin D curve} &: \A = 0, \gam<0
\intertext{Implied monopoly price with constant MC $c$}
p^M(c) &= \frac{\A + \gam c}{1+\gam}
\intertext{Demand Instruments}
High \ Season &: \text{dummy variable for fruit-canning season} 
\intertext{High Season shifts demand out, and makes it more inelastic}
\end{align*}

#### Conduct and costs
\begin{align*}
\intertext{General Pricing Rule}
P(c) &= \frac{\theta \A + \gam c}{\gam + \theta}
\intertext{Elasticity-adjusted Lerner Index}
L_{\eta} &= \eta(P) \frac{P-c}P
\intertext{NEIO conduct estimate $\hat{\theta}$}
P = \frac{\theta \A + \gam c_0 + \gam k P_{raw}}{\gam + \theta}
\end{align*}

Comparison finds:

1. NEIO estimates $\theta$ reasonably well. $\theta$ is underestimated due to correlation between $L_\eta$ and *High Season*
2. Cost parameters are not as well estimated
     - $k$ is under estimated
     - $c_0$ is over estimated
3. Partial cost information doesn't improve $\hat{\theta}$, but does improve cost parameter estimated. $k$ inclusion improves $c_0$ estimates
		

***
# L4: Differentiated Product Markets I: Linear D & S
#### Recommended reading: 

- Reiss and Wolak (2006) p. 57-85; ABBP (2006) p. 6-31

## Product-Space Demand Systems
Change from mkt-level p & q, to product level p & q \
Reference: Almost Ideal Demand System \tcite{Deaton and Muellbauer, 1982 AER}

* j=1:J products, m=1:M markets, and t=t:T periods
* ___Endogenous___ Variables
     + $\{p_{jmt}, q_{jmt} \}$ observed prices and quanities
* ___Exogenous___ Variables
     + $x_{jmt}$ demand shifters
     + $w_{jmt}$ supply shifters

### Log-Lin system

\begin{align*}
\intertext{Let $k=1:J$}
\ln(q_{jt}(\mathbf{p}_t)) &= \A_j + \sum_{k \in J} \eta_{jk} \ln(p_{kt}) + \eps_{jt} 
\\ \A_j &\equiv \text{ product j's fixed effect}
\\ \eta_{jk} &\equiv \text{ price elasticity of demand for product j, wrt product k's price}
\\ \eps_{jt} &\equiv \text{ product j's unobservables in period t}
\end{align*}

\ |Benefits | Problems
 ------|:-----------------------|:----------------------------------
\ |1. $\A_j$ controls for time-invariant demand effects | 1. ***Curse of Dimensionality***: estimation requires $J^2$ elasticity terms, identification is \ |suspect even with assumptions
**Product Space** |2. Easy to estimate for few products |  2. ***Lack prediction*** on new product effects
\ |3. Data easy to obtain |  3. ***Endogeneity Problem***: need at least $J$ instruments for $J$ demand eqns, because $p, ln(q)$ simultaneous from NE
\ |-----------------------|----------------------------------
**Characteristic Space** |  | Characteristics data difficult, judgement of inclusion,
\ |  Can handle new products | Assumes exog characteristics
\ | | Still have lots of elasticity terms

#### Example: Cars

* choice set of 3 cars 
* Set-up log-lin system :(L04-S6,S7)
* Illustration of problems and potential solutions (L04-S10)
    1. Assume some cross-price elasticities are zero, if not substitutes (e.g. Jag & ute)
    2. Ex-ante impact of new product entrant (e.g. Falcon) requires assumptions on fixed effect, and all cross-prices
         

## Characteristic-Space Demand systems

* Let each good $j$ be a bundle of c=1:C characteristics
* Let $\B$ denote the vector of marginal effects of each characteristic on demand
    + $x_j = [x_{1j} \ x_{2j} \ ... x_{Cj}]$
    + $\B = [\B_{c}]_{c=1}^{c=C}$
* Replace product intercepts ($\A_j$) with charactersitic effects ($x_j \B$)
    \begin{equation*} 
    ln(q_{jt}(\mathbf{p}_t)) = x_j \B + \sum_{k \in J} \eta_{jk} ln(p_{kt}) + \eps_{jt} 
    \end{equation*}
    
**** 

\newcommand{\deltavec}{\bm{\delta}}
# L5: Differentiated Product Markets II: Logit Model
#### Recommended reading: 

- Reiss and Wolak (2006) p. 57-85; ABBP (2006) p. 6-31

## Discrete choice demand models
* Use characteristic space system
* Define consumer preferences over product characteristics
* Consumer chooses **ONE** utility maximising bundle of characterstics (single product choice)
* Product-level data, with aggregate market shares $s_{jmt} = \frac{q_{jmt}}{Q_{jmt}}$
* Assumptions:
        1. Product characteristics constant over consumers \TK{no bespoke?}
        2. Choice sets constant over consumers
        3. Consumers only purchase ONE product

## 1. Logit Demand Model Set-Up

### Utility specification

All consumers have same preference for characteristics and quality, but idiosyncratic taste for each product
\newcommand{\tasteshock}{\eps_{ij}}
\newcommand{\prestige}{\xi_j}
\newcommand{\meanU}{\delta_j}
\begin{align*}
\intertext{Utility of consumer i, from consuming product j}
U_{ij} &= x_j \B - \A p_j + \underset{\text{composite unobs}}{\prestige + \tasteshock}
\intertext{Observables}
x_j &\equiv \text{ vector of characteristics}
\\ p_j &\equiv \text{ price of product j}
\intertext{Unobservables}
\prestige &\equiv \text{ product quality obs by consumers but not econom, no dist}
\\ \tasteshock &\equiv \text{ consumer, product specific i.i.d Logit shock w/ $\mu =0$ }
\intertext{Mean and Idiosyncratic utility}
U_{ij} &= \underset{\meanU}{x_j \B - \A p_j + \prestige} + \tasteshock
\\ &= \meanU + \tasteshock
\end{align*}

* i.i.d shocks: distributed as Type 1 Extreme Value ("Logit") with CDF, $F(\tasteshock;\mu,\sigma)$
* without taste shocks, all consumers will choose product with highest $\meanU$
* __horizontal differentiation__, where consumers do not agree due to taste shocks

\begin{align*}
\intertext{Level and Scale of utility: $U_{ij}$ same pref as $a + bU_{ij}$. Normalise $a$ using outside good $j=0$, and $b$ using variance of tasteshock:}
\delta_0 &= 0, \ p_0 = 0
\\ \sigma &= 1
\end{align*}

<!-- ### 1-3. General model w/ J goods -->

### Market Shares, Demand Elasticities

#### Example: Cars (2 goods)

* J=1, one car, one outside good of not purchasing
* action of consumer $a_i = {0,1}$
     + If $\delta_0 + \eps_{i0} > \delta_1 + \eps_{i1}$, choose outside good ($a_i = 0$)
     + If $\eps{i1} > \eps{i0} - \delta_1$

\image{EMC-L05-S15.jpg}{0.7}{Purchase of inside and outside goods}


Market shares for 2-good model L05-S17

\begin{align*}
\intertext{Share of consumers who choose $a_i = 0$}
s_0 (\deltavec) &= 1 - \sum_{j=1}^J s_j(\deltavec)
\intertext{McFadden (1974) shows that with Logit shocks:}
s_j(\deltavec) &= \frac{ \exp{\delta_j} }{ \sum_{j=0}^J \exp{\delta_j}}
\\ &= \frac{ \exp ( x_1 \B - \A p_1 + \prestige )}{ 1 +  \sum_{j=1}^J \exp (x_1 \B - \A p_j + \prestige)}
\intertext{total demand for Q possible consumers}
q^d_j &= s_j(\deltavec) Q
\intertext{own-price and cross-price elasticity}
\eta_{jj} &= \pd{q^d_j}{p_j} \frac{p_j}{q^d_j}
\\ &= Q \pd{s_j}{p_j} \frac{p_j}{s_j Q}
\\ &= \pd{s_j}{p_j} \frac{p_j}{s_j}
\\ &= -\A s_j ( 1- s_j) \cdot \frac{p_j}{s_j}
\\ &= -\A p_j (1-s_j)
\\ \eta_{jk} &= \pd{q^d_j}{p_k} \frac{p_k}{q^d_j}
\\ &= \pd{s_j}{p_k} \frac{p_k}{s_j}
\\ &= \A s_j s_k \cdot \frac{p_k}{s_j}
\\ &= \A p_k s_k 
\end{align*}

\newcommand{\om}{\omega}
\newcommand{\xivec}{\bm{\xi}}
\newcommand{\pvec}{\bm{p}}
\newcommand{\svec}{\bm{s}}

1. Own-price elasticity is increasing in price
     + mkt share - own price derivative dpeends only on mkt shares ($\pd{s_j}{p_j} = -\A s_j (1-s_j)$)
     + unrealistic since purchasers of expensive products generally less price sensitive
     + restricts mark-up to be the same if mkt share is the same
2. Cross-price elasticity depends only on other product
     + mkt share - cross price derivative = $\A s_j s_k$
     + restricts all goods to be strategic complements
     + depend on shares and prices, but not similarities
* Logit is overly restrictive on substitution patterns and market-ups
3. Endogeniety of prices
     + $p_j$ correlated with $\prestige$
     + firms with higher $\prestige$ charge higher prices in NE, but that NE is simultaneously determined

#### Independence of Irrelevant Alternatives (IIA) 
Expanding the choice set does not affect the relative odds of making an existing choice. 

\TK{red bus, blue bus}

### Supply side

* Assume one firm per product, strategic price setters
* no fixed costs, and constant MC

\begin{align*}
\underset{MC}{c_j(\gam,w_j,\om_j)} &= \underset{\text{MC determinants, vector of cost parameters, unobs cost shocks}}{w_j \gam + \om}
\intertext{Profit fnc for firm j; no FCs}
\pi_j(\deltavec,\gam,w_j,\om_j) &= (p_j - c_j) q_j
\\ &= [p_j - c_j(\gam,w_j,\om_j)] \underset{q_j}{s_j(\deltavec) Q}
\intertext{J FOCs characterise NE price vector}
\pd{\pi_j}{p_j} &= [p_j^{*} - c_j(\gam,w_j,\om_j)]\pd{s_j(\xvec,\pvec^{*},\xivec,\theta)}{p_j} + s_j(x,\pvec^{*},\xivec,\theta)
\\ p_j &= c_j + \lvert s_j(x,\pvec^{*},\xivec,\theta) / \pd{s_j(\xvec,\pvec^{*},\xivec,\theta)}{p_j} \lvert
\end{align*}

<!-- ### Empirical Implementation of Discrete Choice Models -->

<!-- 1. Estimate demand side ($\A, \B$) first -->
<!-- 2. Given ($\A, \B$), recove supply side ($\gam$) -->

## 3. Estimation of Logit Model
### Data to Model 
Observed shares and model prediction for given $\theta = (\A,\B)$, rationalised at aggregate level with unobs $\prestige$:
\begin{align*}
\underset{\text{data}}{s_j} &= \hat{s_j}(\deltavec) = \frac{ \exp ( x_1 \B - \A p_1 + \prestige )}{ 1 +  \sum_{j=1}^J \exp (x_1 \B - \A p_j + \prestige)}
\end{align*}

However, aggregate unobs $\prestige$ enters in non-linear fashion. $\tasteshock$ rationalise at individual level, but are integrated out at aggregate level. \
Berry (1994) shows that under:

* under weak regularity conditions on the distribution of $\tasteshock$ [Type 1 EV is sufficient]
* and given normalisation $\delta_0 = 0$
    + There is a one-to-one mapping btwn such that $s = \hat{s}(\deltavec)$. 
    + This mapping is invertible: $\deltavec(\svec) = \hat{\svec}^{-1} (\svec)$, 
    + and returns only one vector of mean utilities for an observed vector of mkt shares. 

<!-- \begin{align*} -->
<!-- %s_0 &= \hat{s_0}(\deltavec)  -->
<!-- %\\ s_1 &= \hat{s_1}(\deltavec) -->
<!-- %\\ &\vdots -->
<!-- %\\ s_J &= \hat{s_J}(\deltavec) -->
<!-- %\intertext{which is invertible} -->
<!-- \end{align*} -->

### Demand estimation
1. Inverse fnc of exponential is natural log, using normalisation for j=0, we can invert market shares for mean utility:
\begin{align*}
ln(s_j) - ln(s_0) &= ln(\frac{ \exp{\delta_j} }{ \sum_{k=0}^J \exp{\delta_k}} ) - ln(\frac{ \exp{\delta_0} }{ \sum_{k=0}^J \exp{\delta_k}})
\\ &= ln(\exp(\delta_j)) - ln(\sum_{k=0}^J \exp{\delta_k}) - ln(1) - ln(\sum_{k=0}^J \exp{\delta_k}) 
\\ &= \delta_j
\intertext{Definition of mean utility $\delta_j(\svec)$, gives unobs $\prestige$ in linear fnc, allowing for standard IV techniques}
\delta_j(\svec) &= x_j \B - \A p + \prestige
\intertext{2. Estimate linear eqn, using 2SLS and excluded instruments for p}
\delta_{jmt} = x_{jmt} \B - \A p_{jmt} + \xi_{jmt}
\end{align*}

___Instruments for $p_j$___

Two primary types of instruments are used to generate exog. variation in prices to estimate demand/utility:

1. ***Cost variables***: elements of $w_j$ that are excluded from $x_j$, such as input prices
2. ***Characteristics of products***: 
      a) Products of rival firms or non-j products from own firm 
              + $x_{-j}$ do not directly enter into utility $U_{ij}$ but affect $p_{j}$ through firm mark-ups in FOCs
              + requires exogenous product characteristics
              + implicitly assumes prices are flexible in short run, but product characteristics are not
      b) Own product characteristics
      
### Supply estimation
From FOCs
\begin{align*}
c_j &= p_j + \lvert s_j(x,\pvec^{*},\xivec,\theta) / \pd{s_j(x,\pvec^{*},\xivec,\theta)}{p_j} \lvert
\intertext{Under logit, and with unique mapping $\hat{s} = s$}
c_j &= p_j - \lvert \frac{s_j}{-\hat{\A} s_j (1-s_j)} \lvert
\\ &= p_j - \frac{1}{(1-s_j)\abs{\hat{\A}}}
\end{align*}
      
## Summary of Logit Implementation
#### Demand estimation

1. Invert mean utility
     + Use: $\delta_j = ln(s_j) - ln(s_0)$
2. Estimate utility function parameters ($\hat{\A}, \hat{\B}$), and structural error of prestige ($\hat{\xi}$)
     + Use: $\delta_{jmt} = x_{jmt} \B - \A p_{jmt} + \xi_{jmt}$
     + Instrument for $p_{jmt}$ w/ excluded cost variables or product characteristics, use 2SlS
3. Can caluculate:
     + own-price elasticity
         - mkt share: $\pd{s_j}{p_j} = -\A s_j (1-s_j)$
         - demand: $\eta_{jj} = \pd{q^d_j}{p_j} \frac{p_j}{q^d_j} = -\A p_j (1-s_j)$
     + cross-price elasticity
         - mkt share: $\pd{s_j}{p_k} = \A s_j s_k$
         - demand: $\eta_{jk} = \pd{q^d_j}{p_k} \frac{p_k}{q^d_j} = \A p_k s_k$
     + CS

#### Supply estimation

4. Recover marginal costs, which rationalises the FOC
     + Use: $c_j = p_j - \frac{1}{(1-s_j)\abs{\hat{\A}}}$
     + $\hat{mc_j} = ln(c_j)$
5. Estimate cost parameters ($\gam$) and structural error of unobs cost ($\om$) using recoved MCs
     + Use: $\hat{mc}_{jmt} = w_{jmt} \gam + \om_{jmt}$ with 2SLS
     + Note that technically std errors for $\gam$ should be adjusted for first stage demand estimation error. Achieveable with joint estimation
6. Can calculate:
     + PS
     + eqlbm outcomes
     + merger analysis
     
## Policy Analysis

* Must hold structural errors ($\hat{\xi}_{jmt}, \hat{\om}_{jmt}$) at estimated values:
     + $\hat{\xi}_{jmt} = \delta_{jmt} - x_{jmt}\hat{\B} + \hat{\A}p_{jmt}$
     + $\hat{\om}_{jmt} = c_{jmt} - w_{jmt} \hat{\gam}$
* Assume these are unchanged before and after policy change or simulation
* Utility interpretation
     + $\frac{\B_c}{\A}$ gives change in dollar utility from characteristic c
     + $\frac{1}{\A}$ converts logit utils back into dollars (price); $\B$ estimate change in logit utlis from characteristic

## Case Study: Logit Cable Act

\tcite{Crawford, 2000} 
Q: What was the welfare impact of the 1992 Cable Act on consumer welfare? \
Context: FCC introduced basic cable price regulation, but cable bills increased. Cable companies introduced non-basic channels that were not subject to price regulation \

Data: 

- Source: cable system database
- Unit of Obs: (cable system, month, year), 
     + 344 individual cable systems, monthly between Feb 1992 (pre-act) and 1995 (post-act)
- Dataset: cable package prices, channels, market shares

Method:

- required characteristic space, because product-space systems cannot handle the change in product characteristics over time 
- used Berry (1994)
- Instruments for prices:
     + market size
     + national subscription size (exog to local D shocks)
     + dummy for operating multiple systems in multiple markets

Welfare measurement:

- used ___equivalent variation___, which compares CS before and after change
- Simulations (hypothetical and actual)
    1) Fix programming at pre-act values. Decrease prices by 10% and 17%
         - gives potential gains if cable companies **did not** change their packages
    2) Allowing changes as observed
         - estimates realised gain/loss to households
         
# L6: Differentiated Products III: Random Coefficients Logit (“BLP”)
#### Recommended reading:

- Reiss and Wolak (2006) p. 57-85; ABBP (2006) p. 6-31,
- Nevo (2000): “A Practioner’s Guide to Estimation of Random Coefficients Logit Demand Models”, Journal of Economics and Management Strategy
- Reference: Berry, Levinsohn, and Pakes (1995): “Automobile Price in Market Equilibrium”, Econometrica

## BLP Set-Up

\ |Logit | BLP
 ------------|:-----------------------:|:-------------------------:|
Properties | own-price elas increasing w/ price |flexible own-price elas
\ | IIA cross-price elas | flexible cross-price elas
Implementation | easy inversion of mean utility | difficult to invert
Utility | $U_{ij} = x_j \B - \A p_j + \xi_j + \eps_{ij}$ | $U_{ij} = x_j {\B_i} - \A p_j + \xi_j + \eps_{ij}$

* $\B_i$ is a random vector of $C$ coefficients that governs preferences for characteristics $c=1:C$ in $x_j$
    + $\B_ic = \B_c + \sig_{\B_c} \eta_{ic}$
    + $\eta_{ik} \sim N(0,1)$ i.i.d
    + Let $\B$ be the vector of mean coefficients $\B_c$, and $\sig_{\B}$ be the vector of variances

\begin{align*}
U_{ij} &= x_j {\B_i} - \A p_j + \xi_j + \eps_{ij}
\\ &= x_j \B + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c} \eta_{ic}] - \A p_j + \xi_j + \eps_{ij}
\\ &= \underset{\delta_j}{x_j \B - \A p_j + \xi_j} + \underset{v_{ij}}{\sum_{c=1}^{C} [x_{jc} \sig_{\B_c} \eta_{ic}] + \eps_{ij}}
\\ &= \underset{\text{mean utility}}{\delta_j} + \underset{\text{preference shocks}}{v_{ij}}
\end{align*}
* preferences shocks $v_{ij}$ are no longer i.i.d ($\epsilon_{ij}$), but depend on product characteristics $x_{j}$
* $\A_i$ is a random vector of coefficients that governs sensitivity to price

## BLP Estimation
### Demand estimation


1. Invert mean utilities
     + no simple inversion, need to use monte-carlo integration
     a) Market Shares, given parameters
          \begin{align*}
          \intertext{Utility Fnc, set of consumers who choose good j}
          U_{ij} &= \delta_j + v_{ij}
          \\ S_{a=j \lvert \deltavec} &= \{ i: \delta_{j} + v_{ij} > \delta_{j'} + v_{ij'} \forall j'\}
          \\ s_j(\deltavec) &= \int_{S_{a=j \lvert \deltavec}} f(v_i) dv_i
          \intertext{For Type 1 EV i.i.d $\epsilon_{ij}$, integrate out taste-shocks}
          s_j(\deltavec,\sig_{\B}\lvert \eta_i) &= \frac{\exp (\delta_j + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c} \eta_{ic}])}{1 + \sum_{j'=1}^J \exp (\delta_j + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c}}
          \intertext{Integrate out coefficient shocks, via Monte-Carlo simulation (i=1:D draws, fixed for estimation)}
          s_j(\deltavec,\sig_{\B}) &= \int_{\eta_i} \frac{\exp (\delta_j + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c} \eta_{ic}])}{1 + \sum_{j'=1}^J \exp (\delta_j + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c}]} dG(\eta_i)
          \\ \hat{s}_j(\deltavec,\sig_{\B}) &= \frac{1}{D} \sum_{i=1}^D \int_{\eta_i} \frac{\exp (\delta_j + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c} \eta_{ic}])}{1 + \sum_{j'=1}^J \exp (\delta_j + \sum_{c=1}^{C} [x_{jc} \sig_{\B_c}]} dG(\eta_i)
          \end{align*}
    b) Inverting Market Shares \
    BLP finds contraction mapping between $\hat{s}$ and $s$ observered.
    \begin{align*}
    \hat{\svec}(\deltavec,\sigma_{\B}) &= \svec
    \\ \Rightarrow \deltavec &= \hat{\svec}^{-1}(\svec)
    \intertext{Contraction Mapping Theorem says that mapping $T(\cdot)$ has unique fixed point $\deltavec^{*}$}
    \deltavec &= \underset{T(\deltavec)}{\deltavec + ln(\svec) - ln(\hat{\svec})}
    \\ \deltavec^{*} &= T(\deltavec^{*})
    \end{align*}
         i. start w/ initial guess $\deltavec^0$
         ii. compute $\deltavec^1 = \deltavec^0 + ln(\svec) - ln(\hat{\svec}(\deltavec^0,\sigma_{\B}))$
         iii. compare norm $d(\deltavec^0,\deltavec^1) = \lVert \deltavec^0 - \deltavec^1 \rVert$ to tolerance level. Stop if norm is less than tolerance, continue with updated guess otherwise.

2. Recover unobserved product qualities
$\xivec = \deltavec -\xvec \B + \A \pvec$

2. GMM estimation of parameters ($\theta = [\A, \B, \sigma_{\B}$)
      a) Construct population moment (orthogonality) conditions with $z_{jmt}$ as a $1 \times L$ vector of instruments: $E[\xi_{jmt}(\theta) \vert z_{jmt}] = 0$
           + if $L > P$, instruments greater than parameters, model is over-identified, and we have more moment conditions than parameters, and no unique solution to the system of sample moment conditions.
      b) For over-identified models, find non-unique $\hat{\theta}$ that minimises the GMM obj function:
      \begin{align*}
      Q(\theta,z) &= \left[ \frac{1}{N} \sum_{i=1}^N g(z_i,\theta)\right]' W \left[ \frac{1}{N} \sum_{i=1}^N g(z_i,\theta)\right]
      \\ \left[ \frac{1}{N} \sum_{i=1}^N g(z_i,\theta)\right] &: L \times 1 \text{ vector of sample (avg) moment conditions }
      \\ W &: L \times L \text{ weighting matrix}
      \\ W &= (z'z)^{-1} \text { weights less noisy moments more}
      \\ \hat{\theta}_{GMM} &= (x'zWz'x)^{-1} (x'zWz'y) \text{ analytical solution}
      \intertext{In BLP, need to minimise numerically, L06-S38 for aside}
      \frac{1}{N} \sum_{i=1}^N g(z_i,\theta) &= \frac{1}{N_{jmt}} \sum_{i=1}^{N_{jmt}} z'_{jmt} \xi_{jmt}(\theta)
      \end{align*}
          + Grid Search: Slow but robust
                  i. create grid of M parameter vectors
                  ii. Compute $Q(\theta^m,z), over m=1:M$
                  iii. Pick $\theta^m$ that yields minimum value as GMM estimate
          + Newton Hill Climbing (\verb|fmin| in MATLAB): fast but not robust, local minimisation
                  i. start with initial guess $\theta^0$
                  ii. Iterate over $\theta^1 = \theta^0 - \frac{Q(\theta^0,z)}{Q'(\theta^0,z)}$ until convergence


\begin{figure}
\includegraphics{EMC-L06-S42.jpg}
\caption{Summary of BLP Algorithm}
\end{figure}

<!-- utility | $U_{ij} = x_j \B − \A p_j + \xi_j + \eps_{ij}$ | $U_{ij} = x_j \underset{rand coeff}{\B_i} − \A p_j + \xi_j + \eps_{ij}$ -->

### Supply estimation

1. Invert FOCs
\begin{align*}
c_j &= p_j - \lvert s_j(x,\pvec^{*},\xivec,\theta) / \pd{s_j(x,\pvec^{*},\xivec,\theta)}{p_j} \lvert
\intertext{Use secant or two-point formula to approximate $\pd{s_j(x,\pvec^{*},\xivec,\theta)}{p_j}$}
\pd{s_j(x,\pvec^{*},\xivec,\theta)}{p_j} &\approx  \frac{s_j(x,[p_j + k, p_{-j}],\xivec,\theta) - s_j(x,\pvec=[p_j,p_{-j}],\xivec,\theta)}{k}
\\ \pd{s_j(x,\pvec^{*},\xivec,\theta)}{p_j} &\approx  \frac{s_j(x,[p_j + k, p_{-j}],\xivec,\theta) - s_j(x,[p_j - k ,p_{-j}],\xivec,\theta)}{2k}
\intertext{Each firm will have it's own first order conditions, summarised in the ownership matrix $\Omega$}
\end{align*}
2. Estimate MC function

- Use: $c_{jmt} = w_{jmt} \gam + \om_{jmt}$
- $w_{jmt}$ includes:
       * product characteristics $x_{jmt}$
       * demographics $D_mt$
       * costs shifters $w_mt$
- need to account for estimation error if using 2SLS

### Simulatenous estimation of Demand and Supply by GMM

1. Define parameters and errors:
     - parameters: $\theta = [\A, \B, \pi^{\B}, \pi^{\A}, \sigma_{\B}, \sigma_{\A}, \gam]$
     - structural errors: $\xi_{jmt} = \delta_{jmt} - x_{jmt} \B + \A p_{jmt}$, $\om_{jmt} = c_{jmt}(\A, \B, \pi^{\B}, \pi^{\A}, \sigma_{\B}, \sigma_{\A}) - w_{jmt}\gam$
2. Define population moment conditions and sample moments
    a) Demand side $L_1 \times 1$: $E[\xi_{jmt}(\theta) \vert z_{jmt}] = 0$
          - $\frac{1}{N_{jmt}} \sum_{i=1}^{N_{jmt}} g(z_{jmt},\theta) = \frac{1}{N_{jmt}} \sum_{i=1}^{N_{jmt}} z'_{jmt} \xi_{jmt}(\theta)$
          - $z_{jmt}  = [ x_{jmt} \ D_{mt} \ \undersetbrace{\text{excluded price instruments}}{w_{jmt} \ \tilde{x}_{jmt}  \ \tilde{x}_{-jmt}  \ \tilde{p}_{j-mt}}]'$
    b) Supply side $L_2 \times 1$: $E[\om_{jmt}(\theta) \vert w_{jmt}] = 0$
          - $\frac{1}{N_{jmt}} \sum_{i=1}^{N_{jmt}} h(w_{jmt},\theta) = \frac{1}{N_{jmt}} \sum_{i=1}^{N_{jmt}} w'_{jmt} \om_{jmt}(\theta)$
3. Define the GMM objective function
     a) Stack the $L = L_1 + L_2$ sample moment conditions: \
     $G = [G^1(z,\theta), G^2(w,\theta)]'$ is $L \times 1$ vector of all conditions
     b) GMM: $Q(\theta,z,w) = G'WG$, with $W$ optimal weighting matrix \tcite{see Wooldridge (2010) ch. 14}
4. Minimise GMM for GMM estimator
     - $\hat{\theta} = \underset{\theta}{\arg\min} Q(\theta,z,w)$
     - Use BLP algorithm as before, but need to invert FOCs also well to recover $\om_j$; not just $\xi_j$.

## BLP Specification & Identification

### Model specifications

\begin{equation*}
U_{ijmt} = x_{jt} \B - \A p_{jmt} + \xi_{jmt} + v_{ijmt}
\end{equation*}

___Coefficients and Demographics___

\ | Coefficient | Structural Parameters | Shocks ($v_{ij}$)
--------:|:---------------------:|:--------------:|:-----------------:|
Characteristics |$\B_ic = \B_c + \sigma_{\B_c}\eta_{ic}$ | $[\A, \B, \sigma_{\B}]$ | $\epsilon_{ij}$: Type 1 EV, $\eta_{i\B} \sim N(0,1)$
Price | $\B_i, \A_i = \A + \sigma_{\A}\eta_{i\A}$ | $[\A, \B, \sigma_{\B}, \sigma_{\A}]$ | $\eta_{i\A} \sim N(0,1)$
Demographics | $\B_i = \B_c + \pi^{\B c} D_i + \sigma_{\B_c}\eta_{ic}$, $\A_i =  \A + \pi^{\A} D_i + \sigma_{\A}\eta_{i\A}$ | $[\A, \B, \pi^{\B}, \pi^{\A}, \sigma_{\B}, \sigma_{\A}]$ | $v_{ij}(\pi^{\B}, \pi^{\A}, \sigma_{\B}, \sigma_{\A})$

Richest specification: Characteristics, Price and Demographics: \
$U_{ij} = \underset{\delta_j}{x_j\B - \A p + \xi_j} + \sum_{c=1}^C \left[ x_{jc} (D_m \pi^{\B c} + \sigma_{\B_c}\eta_{ic}) \right] - p_j (D_m \pi^{\A} D_i + \sigma_{\A}\eta_{i\A}) + \epsilon_{ij}$

___Characteristic Choice___

* Variables in $x_j$ depend on data available:
    + Cross-market (m=1:M,t=1), Cross-time (m=1,t=1:T), Cross-firm (m=M,t=T)
* Dummies possible given data, identify time invariant prestige:
     + Time: need rich CM,
     + Market: need rich CT,
     + Time & Market: need both rich CM and CT
     + Firm: decent CM and CT, with CF data

___Parameter Inclusion___

* In practice estimate:
     + $\A$ and as many $\B$ parameters as possible, all enter GMM linearly
     + $\sigma_{\A}$, and some $\pi^{\A}$ to get flexibility in price elasticities BUT need lots of instruments to identify many $\pi^{\A}$
     + Small number of $\sigma_{\B}, \pi^{\B}$ because these enter in highly non-linear fashion. Especially if individual $D_i$ demographics are available.

### BLP Identification

#### Demand Side
___Prestige___

\begin{equation*}
\xi_{jmt} = \undersetbrace{\text{dummy variables}}{\xi_j + \xi_{f(j)} + \xi_m + \xi_t} + \underset{transitory d shock}{\Delta\xi_{jmt}}
\end{equation*}

* Control using dummy variables, still might have time-varying endogeneity $E(\Delta \xi_{jt} p_{jt})>0$

___Demand Parameters___

\begin{equation*}
U_{ij} = \undersetbrace{\delta_j}{x_j\B - \A p + \xi_j} + \undersetbrace{v_{ij}(\pi^{\B}, \pi^{\A}, \sigma_{\B}, \sigma_{\A})}{\sum_{c=1}^C \left[ x_{jc} (D_m \pi^{\B c} + \sigma_{\B_c}\eta_{ic}) \right] - p_j (D_m \pi^{\A} D_i + \sigma_{\A}\eta_{i\A}) + \epsilon_{ij}}
\end{equation*}

* Identification of $\A, \B$ clear, but others murky
* Identification of $\A, \sigma_{\A}, \pi^{\A}$ depends on instruments for prices
     + Prices endogenous
          - higher quality implies higher prices in differentiated bertrand
     + Instruments to generate exog variation in price:
          i. cost shifters (from PC model)
          ii. product characteristics (from Logit)
          iii. prices of product $j$ in other markets, if working with panel data (Hausman Instruments)
* Identification of $\B, \sigma_{\B}, \pi^{\B}$ depends on covariation in characteristics and demographics, with price and shares.

___Thought experiment___

Suppose randomly assign prices, products and demographics across ex-ante identical markets
     + m=1:100 markets, with j=1:3 car models in 2007, all with same $\{ \pvec_{m,2007}, \xvec_{m,2007}, \svec_{m,2007}, D_{m,2007}\}$

Experiments in 2008:

\ | Price | Product | Demographics
------:|:------------:|:------------:|:------------:
Exog. change| $p_{1,m,2008}$ changes | new product (bundle of characteristics) | permanent income in some markets
Mkts | random amounts in each mkt | control-treatment | random assignment in some mkts
Covariance | $\Delta \pvec_{mt}, \Delta \svec_{mt}$| $\Delta \xvec_{mt}, \Delta \svec_{mt}$ | $\Delta D_{inc,mt}, \Delta \svec_{mt}$
Identifies |$\A, \sigma_{\A}$ | $\B, \sigma_{\B}$ | $\pi_{inc}^{\A}, \pi_{inc}^{\B}$

a) Price experiment
     + randomly increase $p_{1,m,2008}$ across M=100 markets; \TK{changes other prices through bertrand NE}
     + covariation btwn $\Delta \pvec_{mt}, \Delta \svec_{mt}$ identifies $\A$ and $\sigma_{\A}$;
     + more covar means larger $\A$, s.e.(covar) small suggest homogenous pref, or $\sigma_{\A}$ is small.
b) Product experiement
     + randomly add new product (j=4) to some markets, acts as new bundle of charcteristics
          - look at variation in product offerings over time or geography since there is little variation in product characteristics otherwise
     + randomly add aircon to some cars (which didnt have it before)
     + covariation btwn $\Delta \xvec_{mt}, \Delta \svec_{mt}$ identifies $\B$ and $\sigma_{\B}$
     + more covariance means larger characteristic effect, while larger s.e. of covar implies more heterogeneity
c) Demographics experiment
     + randomly increase income in different markets
     + covariance between $\Delta D_{inc,mt}$ and $\Delta \svec_{mt}$ identifies $\pi_{inc}^{\A}, \pi_{inc}^{\B}$

___Identifying Assumptions___

$D_{mt}, x_{mt}$ are exogenous

- Exogeneity of $D_{mt}$, but selection bias for goods such as schools or neighbourhoods
- Exogeneity of $x_{mt}$, but if firms strategically choose characteristics

Excluded Instruments for $p_{jmt}$

1. excluded cost shifters
2. characteristics (assumed to be exog)
      a) of own product j
      b) of other products produced by same firm
      c) characteristics of products of rival firms
3. prices from other markets (geographical exclusion)
      - Hausman (1996) Instruments
      - \TK{requires panel data} for inclusion of product, firm, mkt and time dummies
            - remaining $\Delta\xi_{jmt}$ is transient period-to-period demand shock
      - IF $\Delta\xi_{jmt}$ demand shocks are uncorrelated across markets, valid instrument
            - relies on no shopping btwn markets
            - often strong since transient cost shocks affect all firms, and create strong correlation between $\tilde{p}_{j-mt}, p_{jmt}$, satisfying relevance condition
      - also help with lack of variation in $x_{jmt}$ across time and markets \TK{L06-S58}
            
___Demand Sample Moments___

\begin{align*}
E[\xi_{jmt}(\theta) \vert z_{jmt}] &= 0
\\ z_{jmt}  &= [ \undersetbrace{\text{exogenous}}{x_{jmt} \ D_{mt}} \ \undersetbrace{\text{excluded price instruments}}{w_{jmt} \ \tilde{x}_{jmt}  \ \tilde{x}_{-jmt}  \ \tilde{p}_{j-mt}}]'
\\ x_{jmt} &: \text{ prod. characteristics}
\\ D_{mt} &: \text{ consumer demographics}
\\ w_{jmt} &: \text{ cost shifters, excluded}
\\ \tilde{x}_{jmt} &: \text{ sum of characteristics of other non-j products produced by firm f(j)}
\\ \tilde{x}_{-jmt} &: \text{ sum of characteristics of rival firms' products}
\\ \tilde{p}_{j-mt} &: \text{ avg prices of prod j in other markets (Hausman)}
\end{align*}

#### Supply Side

___Supply Sample Moments___

* imposing supply-side conditions allows for simulations, and more efficient estimates
* conditional on demand estimates, $\gam$ is identified from firm prices, and degree of product differentiation
* Covariation between mark-up and exogenous cost shifters across mkts and time identify $\gam$
* $\gam$ often noisy/have large std errors.

# Summary of Logit/BLP Discrete Choice Models

1. Demand-side
     + consumers have (potentially heterogeneous) preferences over
characteristics
     + goods are combinations of characteristics (both observed and
unobserved)
     + utility implies a willingness to pay for goods for a given “price”
2. Supply-side [if needed]
      + suppliers have (potentially heterogeneous) costs (both observed
and unobserved) of producing goods
      + profit maximisation imply a willingness to supply goods for a given “price”
      + Willingness to supply depends on the nature of competition (e.g. Differentiated bertrand)
3. Equilibrium [if needed]
     + Demand-side and supply-side agents are all acting optimally given preferences, costs, information, competition, and any other constraints (government policies, etc.)
4. Data and estimation
5. Results (parameters, counterfactuals, welfare)

# A2: Introduction of the Minivan (Petrin)
Reference: Petrin, A. (2002): “Quantifying the Benefits of New Products: The Case of the Minivan”, Journal
of Political Economy, vol. 110, p. 705-729.

* Goal: show how to improve demand and supply curve estimates with demographic micro-data
     - micro data frees estimates from dependence onf idiosyncractic logit "taste" error
* Application: Introduction of minivan
     - Consumer welfare from expansion of product choice
     - Producer welfare, gain from transitory mkt power of first mover; and cannibalisation of existing product shares
     - Find that CS gain was large, innovator surplus was also positive, but at the expense of other producers
* Method: Random coefficients discrete choice
     - allows consumer substitution patters to reflect consumer-level heterogeneity in characteristic preferences
     - mkt-level data yields imprecise estimates, consumer-level data is an improvement
     - without consumer-level data, Petrin uses mkt-level sales and characteristics, with average demographics and characteristic preferences
     - average family size conditional on minivan purchase identifies the taste coefficient for families and the characteristics of minivans
     - conditional probability of purchase give income levels, identifies income effects. 
   
## General BLP set-up

* Consumers choose product j that yields max utility
* Market shares are obtained from aggregating over consumers

\begin{align*}
\IT{Conditional indirect utility}
   u_{ij}(\theta) &= \delta_j(\theta) + \mu_{ij}(\theta) - \eps_{ij}
\\ d_j(\theta) &: \text{product-specific utility common to all consumers}
\\ \mu_{ij}(\theta) &: \text{heterogeneity in consumer tastes for observed product characteristics}
\\ \eps_{ij} &: \text{"love of variety", i.i.d taste shock}
\IT{2. Common utility}
   d_j = -\A p_j + \Xvec_j \Bvec + \xi_j
\\ \A &: \text{marginal utility of income (higher prices "decrease" income)}
\\ \Xvec_j &: \text{vector of observed product characteristics}
\\ \Bvec &: \text{taste parameters of characteristics}
\\ \xi_j &: \text{utility from unobserved characteristics}
\IT{If $\xi_j$ is correlated with price, estimates of price sensitivity $\A$ will be biased towards zero}
\IT{BLP show $\mu_{ij}(\theta) \ne 0$ is important for estimating demand elasticities}
\end{align*}

#### Identification w/o consumer level data
- use Consumer Expenditure Survey (CEX) data
- Add moments for the difference between observed mkt-level averages, and model predictions
      - Match income group probabilities from model (dummy), to observed from CEX data
      - Match product choice probabilities to household characteristics
      
## Specification 

#### Demand side
\newcommand{\lowinc}{y_i \leq \bar{y}_1}
\newcommand{\midinc}{\bar{y}_1 \leq y_i < \bar{y}_2}
\newcommand{\highinc}{y_i \geq \bar{y}_2}
\begin{align*}
\intertext{1. Utility Specification}
    u_{ij} &= \A_i \ln (y_i - p_j) + \Xvec \B + \sum_k \gam_k v_{ik} x_{ik} + \xi_j + \eps_{ij}
\\ x_{jk} \in \Xvec_j &: \text{kth characteristics of vehicle j (k=1:K characeristics)}
\\  \A_i \ln (y_i - p_j) &: \text{utility from composite commodity good}
\intertext{marginal utility of income varies according to 3 equally sized income groups}
   \A_i &= \begin{cases}
      \A_0 & \text{if } \lowinc
  \\  \A_1 & \text{if } \midinc
  \\  \A_2 & \text{if } \highinc
  \end{cases}
\\ v_{ik} &: \text{idiosyncratic shock of consumer i for product k (i has K shocks)}
\\ \gam_k &: \text{parameter governing heterogeneity of taste for characteristic k across the population}
\\ \gam_{ik} = \gam_k v_{ik} &: \text{consumer i's personal taste for charateristic k}
\intertext{$\gam_{ik}$ depends on demographics}
   mi &: \text{subscript for minivan characteristic}
\\ fs &: \text{subscript for station wagon}
\\ fs_i &: \text{family size of household or consumer i}
\\ \gam_{i,mi} = \gam_{mi} ln(fs_i)v_{i,fv} &: \text{consumer i's taste for minivans}
\\ \gam_{i,sw} = \gam_{sw} ln(fs_i)v_{i,fv} &: \text{consumer i's taste for station wagon}
\\ v_{i,fv} &: \text{commonly distributed idiosyncratic taste for family vehicales (minivans, station wagons)}
\\ ln(fs_i)v_{i,fv} &: \text{demogrphic dependent taste shock}
\\ \gam_{mi},  \gam_{sw} &: \text{taste shifter for different family size}
\intertext{covariance between $\gam_{i,mi}, \gam_{i,sw}$ is increasing in $\gam_{mi}, \gam_{sw}$. Substitution between family vehicles because larger families prefer these cars, or the cars share similar characteristics (independent of demographics)}
\intertext{2. Integration over $\eps_{ij}$ gives the probability household i, purchases good j}
Pr(j \vert \Xvec,i) &= \frac{\exp[\A_i \ln (y_i - p_j) + \Xvec \B + \sum_k \gam_k v_{ik} x_{ik} + \xi_j]}{\sum_l \A_i \ln (y_i - p_l) + \Xvec \B + \sum_k \gam_k v_{ik} x_{ik} + \xi_l}
\intertext{3. Integration over i to get aggregate demand shares $s_j$}
\end{align*}

#### Supply side

* $F$ multiproduct firms, competing in Bertrand-Nash
* given own product characteristics, other product prices and attributes, firms choose prices to maximise profits.
* Each firm f=1:F products a subset $J_f$ of the $j=1:J$ total products
* log-linear MC function, in a vector of $k'$ cost variables, separated into observed $\Wvec_j$ and unobserved $\om_j$

\begin{align*}
\IT{log marginal cost fnc}
   ln(mc_j) &= \Wvec_j \tau + \om_j \tag{1} \label{mcfnc}
\\ \tau &: \text{vector of cost parameters}
\\ mc_j &: \text{obtained from inverting demand, and profit FOCs}
\IT{Profit fnc}
   \Pi_f &= M \sum_{j \in J_f} (p_j - mc_j) s_j(\pvec,\Xvec;\theta)
\\ M &: \text{no. of households in US}
\\ s_j(\cdot) &: \text{good j's predicted market share}
\\ q_j(\pvec,\Xvec;\theta) = M s_j(\pvec,\Xvec;\theta) &: \text{quantity sold of good j}
\IT{J FOCs for static price competition}
   0 &= s_j(\pvec,\Xvec;\theta) + \sum_{r \in J_f} (p_r - mc_r) \pd{s_r(\pvec,\Xvec;\theta)}{p_j} \tag{2} \label{focs}
\IT{Invert FOCs to solve for MC}
   \bm{mc} = \pvec - \Delta(\pvec,\Xvec;\theta)^{-1} \bm{s}(\pvec,\Xvec;\theta)
\\ \Delta(\pvec,\Xvec;\theta) &: \text{ownership matrix}
\\ \pd{s_r(\pvec,\Xvec;\theta)}{p_j} &: \text{own and cross price derivatives}
\IT{\eqref{focs} also used to solve for counterfactual prices; using inverted mcs so p is the unknown}
   \pvec_{cf} &: \text{counter-factual price solution to \eqref{focs}}
\\ \Pi_f(\pvec_{cf}, \bm{mc}; \theta) - \Pi_f(\pvec_0, \bm{mc}; \theta) &: \text{difference in variable profits, with $\pvec_0$ intial prices}
\\ \sum_f \Pi_f(\pvec_{cf}, \bm{mc}; \theta) - \Pi_f(\pvec_0, \bm{mc}; \theta) &: \text{total change in producer profits}
\end{align*}

#### Data

New vehicles (Market-level)

- t=1981-1993
- j=2,407 nameplates marketed in US, with sales over 1,000 vehicle (no limited editions)
- data: $q_{jt}, p_{jt}, x_{jt}$
      - quantity sold
      - list price
      - characteristics: acceleration, dimensions, drive type, fuel efficiency, luxury (air-con std)  
- observations: 916

Demographics of purchasers of new vehicles (census level): CEX

- t=1986-1992
- demographics observations: 30,000
      - estimate distribution of demographics
- purchase observations: 2,660 new vehicle purchases;
      - subsets: minivan, stationwagon, sport-utility vehicles, full-size vans
      - estimate probability of purchases for different income groups
      - also estimate avg family size, and age of head of household
Linking demographics of purchasers to vehicle purchased (via moment conditions)

## GMM Estimation

#### A. Micro moments $G_1(\theta)$

- GMM chooses parameter estimates that minimise the difference between model predicted avgs to observed avgs from census data
- 3 sets of moments
\begin{align*}
\intertext{1: avg probability of vehicle purchase, conditional on inc level}
   &E[ \text{ i purchases new vehicle} \vert  \lowinc ]
\\ &E[ \text{ i purchases new vehicle} \vert \midinc]
\\ &E[ \text{ i purchases new vehicle} \vert \highinc]
\intertext{2: family size and vehicle type}
   &E[ fs_i \vert \text{ i purchases a minivan}]
\\ &E[ fs_i \vert \text{ i purchases a station wagon}]
\\ &E[ fs_i \vert \text{ i purchases a spot-utility}]
\\ &E[ fs_i \vert \text{ i purchases a full-size van}]
\intertext{3: age of head of household (dummy if between 30-60) and vehicle type}
   &E[ midage_i \vert \text{ i purchases a minivan}]
\\ &E[ midage_i \vert \text{ i purchases a station wagon}]
\\ &E[ midage_i \vert \text{ i purchases a spot-utility}]
\\ &E[ midage_i \vert \text{ i purchases a full-size van}]
\end{align*}

##### B. BLP moments $G_2(\theta)$

- 2 sets of moments

\begin{gather*}
\intertext{4: Model share to observed shares}
   s_k(\deltavec(\theta),\theta) - s_j = 0, j = 0,1,\dots J
\intertext{Equivalent to solving $\deltavec(\theta)$ of product dummy variables, tha tmatche prediction to observation}
\intertext{5. Market level disturbances, assumed to be uncorrelated with observed demand and supply variables except price}
   E[\xi_j(\theta_0) \vert (\Xvec,\Wvec)] = E[\om_j(\theta_0) \vert (\Xvec,\Wvec)] = 0
\end{gather*}

- optimal instruments

- product $l$'s characteristics are valid instruments for themselves, because assumed to be exogenous
- prices have two sets of available instruments
       - excluded cost-side variables
       - other products characeristics, which are relevant through FOCs, and no strategically set
       - In year t, first order approximation of optimal price instruments are: 
       \begin{align*}
       \sum_{j\neq l, j \in J_f} x_{jk} &: \text{sum of characteristic k over own-firm's other products}
       \\ \sum_{j \notin J_f} x_{jk} &: \text{sum of characteristic k over competiting-firms' products}
       \end{align*}
       
##### C. Objective Function
\newcommand{\Gvec}{\bm{G}}
\newcommand{\thetahat}{\hat{\theta}}
\begin{align*}
\IT{1. Stack Micro data and BLP moments}
   E(\Gvec(\theta_0)) &= E \begin{bmatrix} \Gvec_1(\theta_0) \\ \Gvec_1(\theta_0) \end{bmatrix} = 0
\IT{2. GMM estimator}
    \thetahat &= \underset{\theta \in \Theta}{\arg\min} \Gvec^{*}(\theta)'\Gvec^{*}(\theta)
\\ \Gvec^{*}(\theta) &= \bm{a}(\tilde{\theta}) \hat{\Gvec}(\theta)
\\ \hat{\Gvec}(\theta) &: \text{sample analogue to } \Gvec(\theta)
\\ \bm{a}(\tilde{\theta}) &: \text{consistent estimate of "sq root" of inverse asymptotic var-cov matrix of moments}
\end{align*}

## Results

A. Descriptive statistics
B. Parameter estimates
      - Demand side estimates
      - \TK{difference between table 4 and 5}
C. Changes in Consumer welfare
      - Table 6: cost-side estimates
      - Table 7: eqblm prices with minivans (observed) and without minivans (cf)
      - Table 8: \TK{sign} avg compensating variation
D. Markups, Producer Surplus, and Profit Dissipation
      - Table 9: Implied mark-ups from demand-side estimates, with bertrand-nash pricing assumption (w/o micro data)
      - Table 10: Avg sales weighted mark-up and price (w/ micro data)
      - Table 11: Difference in variable profits (observed-cf)
      - Table 12: Profit Dissipation (first mover Chrysler's profit loss from entry of Ford and GM minivans)
E. Total Welfare changes: 1984-1988
      - Table 13: Changes in US welfare from minivan innovation (CV + Var Profit change = welfare change)

****

# L7: Mergers
Reference: Nevo, A. (2000): “Mergers with Differentiated Products: The Case of the Ready-to-Eat Cereal Industry”, Rand Journal of Economics

## Model
\newcommand{\Fsubset}{\mathcal{F}}
\newcommand{\mcvec}{\bm{mc}}
- Uses BLP model with random coefficients for price and characteristics, with demographics  
- Firm-side:
       - f=1:F firms, produce subset $\mathcal{F}_{ft}$ of total brands j=1:J
         \begin{align*}
         \text{Profits firm f: }& \pi_{ft} = \sum_{j \in \Fsubset_{ft}}  \left[ (p_{jt} - mc_{jt}) \underbrace{q_{jt}}{Q_t s_{jt}(\pvec_{jt})} \right] - C_{ft}
         \\ \text{FOCs prod j: }& s_{jt}(p) + \sum_{k \in \Fsubset_{ft}}   (p_{kt} - mc_{kt}) \pd{s_{kt}(p)}{p_{jt}} = 0
         \\ \text{Bertrand NE: }& J_t \text{ FOCs}, \pvec_t
         \intertext{Each element $jk$ of ownership matrix is, diagonal if firms produce only 1 product:}
         \Omega(\pvec_t)_{t,jk} &= \begin{cases}
         \pd{s_{jt}}{p_kt} &\text{if } \exists f: \{j,k\} \subset \Fsubset_{ft} \\
         0 &\text{otherwise}
         \end{cases}
         \intertext{FOCs in matrix form, inverted for MCs}
         \svec_t(\pvec_t) + \Omega(\pvec_t)_{t} (\pvec_{t} - \mcvec_{t}) &= 0
         \\ \mcvec_{t} &= \pvec_t + \underset{\text{mark-up}}{\underbrace{\Omega(\pvec_t)^{-1}\svec_t(\pvec_t)}}
         \end{align*}
- Consumer-side:
       - estimate demand using Random Coefficients set-up

## Merger Simulations

In year t=$\tau$, ownership matrix changes, predict effects on welfare:

a) without cost efficiencies
    1. Estimate BLP demand model, recover MC on firm side
    2. Simulate mkt prices w/o merger: \TK{returns same prices?}
    3. Simulate mkt prices w/ merger, hold costs constant
    4. Compare CS/PS pre and post merger, measure effect of increased market power
         i. Compensating variation for simulated consumer i:  
         $CV_i = \frac{1}{\A} \{ \ln[\sum_{j=0}^{J_{mt}}\exp(V_{ij}(\pvec^{*1}_{m \tau}))] - \ln[\sum_{j=0}^{J_{mt}}\exp(V_{ij}(\pvec^{*0}_{m \tau}))]\}$
         ii. Mean Compensating variation for a population: \
         $CV_{mt} = Q_{mt} \int_{v_{ij}} CV_i dP_{mt}(v_{ij})$
     

b) with cost efficiencies 
     1. and 2. same
     3. Simulate mk prices w/ merger, and decrease in mc
     4. same
           - Required cost efficiency such that CV = 0, post merger mc = $\chi \cdot mc^{0}_{mt}$ \
           $\chi : CV(\pvec^{*1}_{m \tau}(\chi),\pvec^{*0}_{m \tau}) = 0$
            
Assumptions for a):

* Merger btwn firms a and b is requivalent to re-labelling products as $\Fsubset_{ab} = \Fsubset_{a} \cup \Fsubset_{b}$
* Demand and cost parameters are the same pre and post-merger
     - D elasticities do not change, brand prestige does not change post-merger
     - cost structure is the same
* No new entrants after merger


## Case Study: Cereal 

#### Set-Up
Model as above

Data: 

* j=1:24 brands, m=1:45 markets, and t=1988Q1-1992Q4 periods
* ___Endogenous___ Variables
     + $\{p_{jmt}, s_{jmt} \}$ observed prices and market shares
* ___Exogenous___ Variables
     + $x_{jt}$: advertising, calories from fat, sugar, mushy, fiber, all-family, kids, adults; qtr and brand dummies also included fixed effects dummy for quarter and brand
     + $D_{i}$: log(income), log(inc)^2, age, child dummy
    
#### Estimation:

* Endogeneity issues $E(\Delta \xi_{jt} p_{jt})>0$:
     - $\xi_{jmt} = \xi_j + \xi_t + \underset{\text{seen by firm}}\Delta\xi_{jmt}$
     - $\Delta \xi$ transitory d shocks, not controlled for by fixed effect dummies.
* \TK{Instruments used}
     - average prices of same good in other cities
     - does not use characteristic based IVs

#### Merger Simulation:

* Non-price competition is ignored (e.g. advertising and brand introduction)

\TK{EMC-L07-S7; first order conditions}

# A3: Merger Simulation (Ice Cream)
# L8: Marketing in BLP & Online Dating

## Marketing

* Quantitative marketing: marketing campaigns affect perceived value from purchasing a product
* Example:
    - company sells single product j, in m=1:M markets
    - run $adv$ in random subset of M markets
    - if market shares increase with advertising, compared to without advertising; $adv$ was likely effective
* Model:
      \begin{align*}
      \intertext{Simple model; only effect on mean utility $\rho$}
      U_{ijm} &= \rho \{adv_m\} + x_j \B + \A p_j + \xi_j + \sum_{c=1}^C \left[ x_{xc} (D_m \pi^{\B c} + \sigma_{\B c} \eta_{ic}) \right] - p_j(D_m \pi^{\A} + \sigma_{\A} \eta_{i \A}) + \epsilon_{ij}
      \intertext{Complex model: mean utility $\rho_1$, price sensitivity $\rho_2$, reponsiveness to characteristics $\rho_3$, demographics $\rho_4$}
      U_{ijm} &= (\rho_1 + \rho_2 p_j + \rho_3 x_j + \rho_4 D_m) \{adv_m\} + x_j \B + \A p_j + \xi_j \\ &\quad + \sum_{c=1}^C \left[ x_{xc} (D_m \pi^{\B c} + \sigma_{\B c} \eta_{ic}) \right] - p_j(D_m \pi^{\A} + \sigma_{\A} \eta_{i \A}) + \epsilon_{ij}
      \end{align*}
      
### Case Study: Campaign Spending
Rekkas, M. (2007): “The Impact of Campaign Spending on Votes in Multiparty Elections,” Review of Economics and Statistics

* Supply side not necessary for question, not modelled
* Campaign spending - marketing spending; effect on Voting behaviour - consumption behaviour
* Allow for heterogeneity in voteer preferences, and endogeneity of campaign spending
* r=1:R electoral districts (riding), i=1:I_r voters in riding r, j=1:J_r parties in riding r.
      - j=1:1672 candidates, r=1:301 ridings
      - includes fringe parties, who are 28% of choice set, but won small share
* ___Endogenous___ Variables
     + $exp_{jr}$ Election Canada data on campaign expenditures
* ___Exogenous___ Variables
     + $x_{jr}$ 
          - candidate characteristics: incumbency, gender, occupation, lagged vote share;
          - riding characteristiccs: population density, change in inc $\times$ incumbency, change in unemployment $\times$ incumbency; where income and unemployment at provincial level
          - fixed effects for riding, party (12), region (5), party $\times$ region (60)
          
___Model___

BLP Demand:
\begin{align*}
\intertext{Utility}
U_{ijr} &= x_{jr} \B + \gam_{1i} exp_{jr} + \gam_{2i} (exp_{jr} \times inc_{jr}) + z_r \A + \xi_{jr} + \epsilon_{ijr}
\\ &= x_{jr} \B + \gam_{1i} exp_{jr} + \gam_{2i} (exp_{jr} \times inc_{jr}) + z_r \A + \underset{\xi_{jr}}{\underbrace{\xi_{j} + \xi_r + \Delta\xi_{jr}}} + \epsilon_{ijr}
\intertext{Heterogeneity}
\begin{pmatrix}  \gam_{1i} \\  \gam_{2i} \end{pmatrix}
&= \begin{pmatrix} \gam_1 \\ \gam_2 \end{pmatrix}
+ \underset{unknown var parameters}{\Sigma} \underset{\sim \mathcal{N}[0,1]}{\begin{pmatrix} v_{1i} \\ v_{2i} \end{pmatrix}}
\intertext{Optimal choice set $S_{jr}$, and vote share $s_{jr}$ are computed by Monte-Carlo simulation}
\end{align*}

___Identification___

Endogeneity of campaign spending: $E[exp_{jr} \Delta\xi_{jr}] >0$
Instruments:

1) riding level average from previous election
      - 70% of candidates are new in current election, so don't carry over $\xi_j$ into current election
      - time-varying competitiveness of a riding $\xi_r$ captures time-invariant part of avg campaign spending
2) closeness of previous election 
      - control for spending more in close ridings
3) and 4) incumbency x IV 1 and IV 2

Doesn't control for changes in electoral boundaries

___Results___

* Table 1: voter shares
* Table 3: demand parameter estimates
    - Model A: Logit, no endog, no hetero
    - Model B: IV Logit, endog, no hetero
    - Model C: Rand Coeff, endog, hetero
* Table 4: mean expenditure elasticities
    - vote share elasticity wrt expenditure of own or other parties
    
## Online Dating

References:
1. Hitsch, G., Hortacsu, A., and D. Ariely (2010): “Matching and Sorting in Online Dating”, American Economic Review
2. Hitsch, G., Hortacsu, A., and D. Ariely (2010): “What makes you click? - Mate Preferences in Online Dating”, Quantitative Marketing and Economics
      
Overview:

* data from user characteristics and interactions
* model predicts observed matches, without using observed matches in estimation

Data:

* 3004 men, 2783 women; Boston and San Diego, daily data for 3.5mths in 2003
     - "casual sex" category dropped
* Product (Women) characteristics:
     - Martial Status (single, married, divorced)
     - Demographics (gender, inc, age, ethnicity, education)
     - Self-reported physical attributes ("looks", height, weight)
     - attractiveness measure (by 100 University of Chicago individuals)
* Outcome:
     - email_{ij} = 1, if man i emails woman j after viewing profile

Estimation:

* Utility of man from match with women or vice-versa
* Leads to probability of contact conditional on browsing profile
     - estimated using fixed effects logit (logit with individual dummies (per person)), based on first contact
* No endogeneity, so no need for IVs
     - can be estimated using Maximum Likelihood rather than GMM
     
Results:

* Match: if after contact, exchange messages to meet up in person
* Simulate matches using Gale-Shapley (1962) deferred acceptance algorithm
      - for man and woman optimal stable matches
      - compare moments of simulations to observed
      - key preference component is ethnicity
* Efficient: users would not "benefit" (gain extra utility) from switching to other matches
* Also does well predicting "offline" marriage markets in Boston and San Diego, but underestimates degree of sorting along education

---

# A3: Price Discrimination w/ coffee (McManus, 2007)
Reference: McManus, B. (2007): “Nonlinear Pricing in an Oligopoly Market: the Case of Specialty Coffee”, Rand
Journal of Economics, vol. 38, p. 512-532.

* Non-linear pricing distorts product characteristics from efficient levels
* Goal: Empricially estimate distortion
* Application: Speciality coffee mkt 
* Method: Structural utility model to compute consumer benefits
* Findings: 
      - design distortions are larger for products not targeted to highest demand consumers
      - distortions decrease toward zeo for drink size for products with largest profit margins

## 1. Introduction 

## 2. Market for specialty coffee

## 3. Empirical Model

#### Observation Units:

- $t$ time period: portion of the day during which a constant number of coffee shops are open
       - Morning: 8am-2pm
       - Afternoon: 2pm-6pm
       - Evening: 6pm-12pm 
       - 21 periods in a week
- Purchase options:
       - $N_t = \sum_{j \in J_t} n_{jt}$: potential customers in each period
       - $i$: consumers make 1 purchase choice per period of zero or one cup of coffee 
       - $j=0, o$: outside option
       - $j=1:J$: coffee shops in the market
       - $J_t$: available options during period $t$
       - $n_{jt} \geq 0$: consumers who select option $j$ during period $t$
- Types of coffee
       - $d$: drip
       - $r$: regular espresso
       - $s$: sweet espresso
       - each $j$ is associated with one product line $d,r,s$
- Weekparts
       - across periods there are differences in markets from which shops are open, location and number of potential consumers, which shift demand
       - assume these mkt-wide common factors are limited to changing in value of outside options
       - 14/21 periods are identical in consumers geographic distribution, choice set, value of outside option
       - assign these identical periods a "weekpart" index to reduce number of predicted mkt share calculations

#### Consumer decisions

Differences are:

- vertical preference: 
       - utlity from extra ounce of drink type $d, r, s$
- horizontal preference: 
       - consumer location
       - idiosyncratic taste shock
       
\begin{align*}
\IT{Utility maximising choice of product j for consumer i, who resides at location $\ell$, at time t}
   U_{ij \ell t} \geq U_{ij' \ell t} & \forall j' \in J
\IT{Utility function from good $j > 0$}
   U_{ij \ell t} &= \B_{xi} q_j ^{\gam_x} + \A p_j + \delta D_{j \ell} + \xi_j + \eps_{ij \ell t}
\\ j &: \text{speciality coffee}
\\ q_j &: \text{size}
\\ p_j &: \text{price}
\\ x \in \{d,r,s\} &: \text{product line}
\\ D_{j \ell} &: \text{distance from consumer's location; distributed independently of $\eps, v$}
\\ \xi_j &: \text{unobserved attributes of j, observed by agents}
\\ \eps_{ij \ell t} &: \text{idiosyncratic taste shock; Type 1 EV distribution}
\IT{Random Coefficients}
\\ \B_{xi} - \B_x \exp(\sigma_x v_{xi}) &: \text{consumer i's taste for product line x}
\\ \B_x &: \text{population wide mean}
\\ v_{xi} &: \text{std normal i.i.d shock}
\\ \exp(\sigma_x v_{xi}) &: \text{unit-median deviation}
\\ \B_{xi} q_j ^{\gam_x} &: \text{gross utility from $q_j$ ounces of line $x$ drink, permits non-linear returns}
\IT{Utility for outside good j = 0, during time t}
    U_{io \ell t} &= X_t \phi + \eps_{io \ell t}
\\ X_t &: \text{vector of dummy variables indicating morning, afternoon or evening $t$}
\IT{Parameters and distributions}
    \theta &= [\B_x, \sigma_x, \gam_x, \delta, \phi]
\\ F_D &: \text{distribution of consumers’ locations, depends on t}
\\ F_v &: \text{distribution of product line x preference shocks, i.i.d std norm}
\\ F_\eps &: \text{distribution of idiosyncratic product j taste shocks}
\IT{Product j mkt share at time t}
   s_{jt(\theta)} &= \int_{A_{jt}} d F_v(v) d F_\eps (\eps) d F_D(D;t)
\\ A_{jt} &: \text{set of $v,\eps, D$ value such that $j$ is preferred to all other options in $J_t$}
\end{align*}

#### Firms

- Research on differentiated products often employs eqlbm assumptions of firm's pricing behaviour
      i. allows for greater precision in demand estimates
      ii. can impute mc from FOC despite lack of cost data
- NO eqlbm pricing assumptions in this model
      - use demand-side parameter estimates, and direct cost data
      - answer if product design predictions of second-degree price discrimination is actually observed
      
## 4. Data, Identification

The price parameter $\alpha$ is identified using the changing price distributions associated with the different opening and closing times of the cafes. Although prices between cafes do not vary much, opening and closing times provide variation in the purchase of the inside goods (coffee). Furthermore, he argues that this price variation is exogenous as shops must set their operating hours according to the UVa facilities that house these shops. 

## 5. Estimation

Maximum likelihood estimation

## 6. Emprical Results

#### Parameter estimates and elasticities

#### Distortions product design

- look at difference between estimated marginal benefit and marginal costs from additional ounce of drink
- The pattern of distortions is consistent with nonlinear pricing theory, which predicts that lower profit products (regular espresso) are degraded to become poorer substitutes for higher profit items (sweet espresso). 

## Summary from A3

The author presents a novel empirical study of product design efficiency under non-linear pricing, as predicted by second-degree price discrimination theory. Using the speciality coffee market near the University of Virginia (UVa), they estimate the allocative distortion in a market with oligopolistic firms that engage in quantity discounting. They use a structural econometric model where consumers have private preferences over vertical and horizontal product characteristics; and compare the benefit of changing product sizes with cost data to examine the efficiency of price-menu choices. 

The dataset includes:
\begin{itemize}
	\item aggregate sales of each menu option in 9 coffee shops observed over 51 days, with 3 time periods per day 
	\item menu prices, which exhibited non-linear pricing in quantity
	\item number of potential consumers, which is used to estimate market shares
	\item census and UVa data, which is used to empirically estimate the distribution of potential coffee shop customers
	\item labor schedules, drink recipes and ingredient prices, which is used to estimate the incremental cost of serving an additional drink, and the marginal cost of increasing the size of a drink by an ounce. 
\end{itemize}

The key findings of the article are that price-menu design distortions are relatively large for products not targeted to the highest demand customers, and distortions decrease as drink size increases for products with the highest product margins. This supports the predictions of non-linear pricing being used to screen for the highest demand customers who purchase the largest efficiently sized option, because all other buyers self-select will into inefficiently small product options.

The author does not use the cost data to impose first-order conditions on the supply side to avoid restricting the estimated distortions to those predicted by firm theory and the assumption of equilibrium pricing.

# L9: Static Discrete Games Estimation: Homogeneous Games
Recommended reading: BR2007 Section 2 (most) and 3 (a bit)

## Motivation
* base understanding of games estimation
* Related I-O questions: 
      - endogenous mkt structure; jointly determined with firms' prices and costs
      - how firms choose products, and product characteristics
            - incl. geographic location of a store
      - allows us to estimate unobs. cost-side variables like FC, entry costs, sunk costs or investment costs
      - consider other anti-competitive behaviour (barriers to entry)

## Model
* Goal: Predict $N_i$ no. of firms in market i
* Rationalise number of firms in i=1:M markets; based on
* Model: 2 Period Oligopoly
      1) T potential entrants decide whether to enter
            - NE outcome determines N
            - homogenous products, costs, prices
            - \TK{all firms earn same profits}
      2) given entry decision N firms decide how much to produce/prices to charge 
            - Linear supply/demand models, Conduct (Bresnahan), Logit, BLP
* Assumptions:
      - symmetric profits/payoffs
      - perfect information
      - non-increasing profits in $N_i$
* Result: Symmetric NE
* Limitations and restrictions:
      i. no heterogeneity in profit parameters across markets
      ii. no heterogeneity in firm profits within markets

### Profit Function
\begin{align*}
\intertext{Firm profits in mkt i}  
\pi(N_i) &= V(N_i, x_i, w_i, \theta) - F_i
\intertext{ Variable profits}
V(\cdot) &: \text{ functional form depends on mkt structure, assume $\pd{V}{N} < 0$}
\\ N_i &: \text{ no. of firms in mkt i}
\\ x_i &: \text{ exog. demand variables, could also include endog. $p$, $q$}
\\ w_i &: \text{ mkt cost variables}
\\ \theta &: \text{ demand, cost, conduct parameters that govern variable profits}
\intertext{Common fixed costs}
F_i &= F + \eps_i
\\ F &: \text{ mean fixed cost of entry}
\\ \eps_i &: \text{ i.i.d $N(0,1)$ mkt-i specific entry cost; structural errors firms observed}
\end{align*}

Example reduced form profit fnc
\begin{align*}
\pi(N_i) &= S_i \cdot [\theta_0 + \theta_1 \left(\frac{1}{N_i} \right) + x_i \theta_2 + w_i \theta_3] - F_i
\\ S_i &: \text{ size of market}
\\ \theta = [\theta_0,\theta_1,\theta_2,\theta_3] &: \text{ parameters that govern profit}
\\ \pd{\pi(N_i)}{S_i} > 0 &: \text{ larger markets yield more profits}
\\ \pd{\pi(N_i)}{N_i} < 0 &: \text{ more competitors mean less profits $\theta_1 \left(\frac{1}{N_i} \right)$}
\end{align*}

### Eqlbm entry decisions

\begin{align*}
\intertext{Characterisation of NE, assumed to be "Revealed"" by firm existence}
\\ N_i^{*} &: \text{ NE no. of entrants in market i}
\intertext{NE must satisfy two conditions}
\intertext{(1) Profitable operation} 
V(N_i^{*}, x_i, w_i, \theta) - (F + \eps_i) &\geq 0
\\                            \Rightarrow V(N_i^{*}, x_i, w_i, \theta) - F &\geq \eps_i
\intertext{(2) Unprofitable entry} 
V(N_i^{*} + 1, x_i, w_i, \theta) - (F + \eps_i) &\geq 0
\\                              \Rightarrow V(N_i^{*} + 1, x_i, w_i, \theta) - F &< \eps_i
\end{align*}

## Estimation: Ordered Probit

\begin{align*}
\intertext{Probability that NE number of firms in a mkt is $N_i$, depends on satisfying both conditions}
\text{Pr($N_i^{*}$ is NE)} &: Pr( \{ \eps_i \leq V(N_i^{*}, x_i, w_i, \theta) - F \} \cap \{ \eps_i > V(N_i^{*} + 1, x_i, w_i, \theta) - F \} )
\\ &= Pr(\eps_i \leq V(N_i^{*}, x_i, w_i, \theta) - F) - Pr(\eps_i \leq V(N_i^{*} + 1, x_i, w_i, \theta) - F)
\\ &= \Phi(V(N_i^{*}, x_i, w_i, \theta) - F) - \Phi(V(N_i^{*} + 1, x_i, w_i, \theta) - F)
\\ \Phi &: N(0,1) \text{ CDF}
\intertext{Form log-likelihood function}
\mathcal{L} &= \sum_{i=1}^M \log \left( \Phi(V(N_i^{*}, x_i, w_i, \theta) - F) - \Phi(V(N_i^{*} + 1, x_i, w_i, \theta) - F) \right)
\intertext{Maximum likelihood estimates}
\arg\max& \mathcal{L} (\{N_i,x_i,w_i\}_{i=1}^T \vert \theta,F)
\end{align*}

References: 

* Computing asymptotic std. errors for ML: Wooldridge Ch 13.
* Details on ordered Probit/Logit models : Woolridge Ch 16

### Data

* Cross-section of i=1=M markets
* Outcome variable: $\{ N_i \}_{i=1}^M$ number of firms in each mkt
* Exogenous:
     - $\{ S_i,x_i, w_i \}_{i=1}^M$ market size, demand and cost shifters
* Parameters: $\theta, F$
* no data on prices, quantities, costs, or profits
* profits are ***latent variable***

### Identification

Without data on prices, quantities, costs, or profits, assumptions are required to identify $\theta, F$

- Variable profits are independently distributed across mkts
- mkt-level fixed cost shocks are independent across mkts
- unobs fixed costs shocks are normally distributed
- pick specification for $V(\cdot)$
       a) **Reduced Form Approach**
       - pick simple specification with $\pd{V}{N} < 0$
       - PRO: simple to calculate, straightforward formation of likelihood
       - CON: lacks interpretation, $\theta$ meanings unclear, form of competition unclear, policy effects unclear
       b) **Structural Approach**
       - assume specific form of competition (e.g. Cournot, Bertrand)
       - derive $V(\cdot)$ that corresponds with NE profits for assumed game
       - PRO: rich interpretation
       - CON: estimation and identification much more difficult
       - \tcite{BR, 2006} show derivation of \TK{V() from homogenou cournot EMC-L9-S13,14}
- Variation in mkt size is important for identification of $F$
       - helps identify the magnitude of F, and $\pd{V}{N} < 0$

## Case study: Entry in Small Markets

Reference: Bresnahan, T., and P. Reiss (1991): “Entry and Competition in Concentrated Markets”, Journal of Political Economy

* Landmark paper in games estimation
* Q: What can entry data (alone) tell us about mark-ups and competition
* A: Method to make statements like "A market w/ $S_i$ population, can support $N^{*} = 2$ dentists in a NE"
* Data: 
     - 202 isolated local mkts in Western US
     - Outcome variable: count of professions (Doctors, Dentists, Druggists, Tires, Car Dealers, Plumbers.. etc)
     - Explanatory variables: 
             - Demographics: population, mkt growth, commuters, used to determine mkt size
             - no info on prices or quantities
     - Table 2: market count of incumbents (N=0:7+) by industry (16)

### Model: 

\begin{align*}
\intertext{Per-firm profits for N firms in a mkt}
\pi_N &= S(\Yvec,\lambda) V_N(\Zvec,\Wvec,\A,\B) - F_N(\Wvec,\gam) + \eps
\\ \Yvec &: \text{ mkt size variables}
\\ \Zvec &: \text{ demand shifters}
\\ \Wvec &: \text{ cost shifters}
\\ \text{Parameters} &: \lambda, \A, \B, \gam
\intertext{Market size specification}
S(\Yvec,\lambda) &= \text{town pop.} + [\lambda] [\text{nearby pop, positive growth, negative growth, commuters out}]'
\intertext{Variable profit specification}
V_N(\Zvec,\Wvec,\A,\B) &= \alpha_1 + \Xvec \B - \sum_{n=2}^N \A_n
\\ \Xvec = [\Zvec,\Wvec] &: \text{ demand and cost variables depend on industry}
\\ \B &: \text{ interpretation really depends on underlying model}
\\ \A_n &: \text{ models marginal decline in profits for more entrants (up to 5)}
\intertext{Fixed cost specification}
F_N &= \gam_1 + \gam_L W_L + \sum_{n=2}^N \gam_n
\\ W_L &: \text{ includes price of land}
\\ \gam_n &: \text{ models marginal increase in FC for later entrants (up to 5)}
\intertext{Monopoly example}
\text{Monopoly profit} &: V_1 = \A_1 + \Xvec \B
\\ \text{Monopoly FC} &: F_1 = \gam_1 + \gam_L W_L
\end{align*}

* Var Proft: As new firm enters, all firms get lower profits
* FC: not clear why exactly later firms have higher FC (cost be ineffiency or high barriers to entry)

### Estimation

Ordered profit ML estimates, exploit entry bounds for i = 1:202 markets
\begin{align*}
\intertext{Find $\lambda, \A, \B, \gam$ that maximise log-likelihood fnc:} 
\mathcal{L} &= \sum_{i=1}^{202} \left[ \log[ \phi (S(\Yvec,\lambda) V_{N_i}(\Zvec,\Wvec,\A,\B) - F_{N_i}(\Wvec,\gam)) - \phi (S(\Yvec,\lambda) V_{N_i+1}(\Zvec,\Wvec,\A,\B) - F_{N_i+1}(\Wvec,\gam))  ]\right]
\\ \eps_i &: \text{ i.i.d N(0,1), so CDF used is $\phi$ for N(0,1)}
\intertext{Also constrain all $\A, \gam > 0$, motivated by oligopoly theory}
\end{align*}

### Analysis
####Entry Thresholds

\TK{EMC-L9-S22; bar over vec?}

\begin{align*}
\intertext{Per-firm profits can be used to calculate entry thresholds w/ zero profit condition; on mean variables}
\pi_N &= S(\Yvec,\lambda) V_N(\Zvec,\Wvec,\A,\B) - F_N(\Wvec,\gam) + \eps
\\ &= 0
\\ \Rightarrow S_N &= \frac{F_N(\bar{\Wvec},\gam)}{V_N(\bar{\Zvec},\bar{\Wvec},\A,\B)}
\\ &= \frac{\hat{\gam}_1 + \hat{\gam}_L \bar{W}_L + \sum_{n=2}^N \hat{\gam}_N}{\hat{\alpha}_1 + \bar{\Xvec} \hat{\B} - \sum_{n=2}^N \hat{\A}_n}
\intertext{$S_N$ is how large a market needs to be to support N entrants. Required mkt size is increasing in FC, and decreasing in variable profits}
\end{align*}

#### Ratio of Entry Thresholds

\begin{align*}
\intertext{Per-firm entry thresholds, measure rate at which mark-ups or variable profits fall with an additional entrant}
\frac{s_{N+1}}{s_N} &; s_N = \frac{S_N}{N}
\\ \frac{s_{N+1}}{s_N} = 1 &: \text{ Entry does not change competitive conduct}
\intertext{For Cournot/Bertrand, as mkt becomes PC, entrants have no effect} 
\lim_{N \rightarrow \infty} \  \frac{s_{N+1}}{s_N} &= 1
\end{align*}

Example:
\begin{align*}
S_1 &= 1000
\\ S_2 &= 10000
\\ s_2 &= 5000 \quad (10000/2)
\\ \frac{s_{2}}{s_1} &= 5
\end{align*}

##### Competiting Theories on Entry effects
Authors believe entry thresholds call because of rising competition.  
However, cannot rule out that entry barriers decline as N rises.  
Therefore, look for direct evidence of increasing competition using tire prices from 165 tire dealers.   
Collect data directly by phoning individual dealers
Regress: tire prices on number of dealers, and other market dummies 
Find mkt prices fall as N increases; hence entry likely lowers margins rather than lowering entry barriers.

\TK{EMC-L0-S23}

# L10: Static Discrete Games Estimation: Heterogeneous Games
Recommended reading: BR2007 Section 2 (most) and 3 (a bit)

## Motivation

  Homogenous |Heterogeneity
 :-------------:|:----------------:
 how many entrants? | who are the entrants?
 single symmetric NE | multiple PSNE, or no PSNE 

## Model

### Entry Game
* simultaneous-entry game
* 2 firms, with perfect info
* NE for independent and simultanous decisions
      - characterised with inequalities/cut-off ranges
      
\begin{align*}
\text{profits} &: \pi_1(a_1,a_2); \ \pi_2(a_1,a_2)
\\ \pi^M = \pi(N=1) &: \text{ monopoly profits}
\\ \pi^D = \pi(N=2) &: \text{ duopoly profits, less than monopoly}
\\ \text{actions} &: a_i =
  \begin{cases}
  0 & \text{Do not Enter} \\
  1 & \text{Enter}
  \end{cases}
\end{align*}

Payoffs
\begin{align*}
   \pi^M_1, \pi^D_1 &= \pi^M_1 - d
\\ \pi^M_2, \pi^D_2 &= \pi^M_2 - d
\\ d &: \text{ reduction in per-firm profits from duopoly}
\end{align*}


  \begin{table}[h]
    \setlength{\extrarowheight}{2pt}
    \begin{tabular}{cc|c|c|}
      & \multicolumn{1}{c}{} & \multicolumn{2}{c}{Firm $2$}\\
      & \multicolumn{1}{c}{} & \multicolumn{1}{c}{$DE$}  & \multicolumn{1}{c}{$E$} \\\cline{3-4}
      \multirow{2}*{Firm $1$}  & $DE$ & $(0,0)$ & $(0,\pi^M_2)$ \\\cline{3-4}
      & $E$ & $(\pi^M_1,0)$ & $(\pi^M_1 - d,\pi^M_2 - d)$ \\\cline{3-4}
    \end{tabular}
  \end{table}
  
Possible outcomes
\begin{align*}
\intertext{Unique NE}
   N=0        &: (a) \pi^M_1 < 0; \ \pi^M_2 < 0
\\ N=1 (1,0)  &: (b1) \pi^M_1 > 0, \ \pi^M_2 < 0
\\            &: (b2) \pi^M_1 > d, \pi^D_2 > 0; \ \pi^M_2 < d, \pi^D_2 < 0
\\    (0,1)   &: (c1) \pi^M_1 < 0; \ \pi^M_2 > 0
\\            &: (c2) \pi^M_1 < d, \pi^D_2 < 0; \ \pi^M_2 > d, \pi^D_2 > 0
\\ N=2       &: (d)  \pi^D_1 > 0; \ \pi^D_2 > 0
\intertext{Multiple NE; neither firm has dominant strategy to enter}
   N=1        &: (e) \pi^M_1 > 0, \pi^D_1 < 0; \pi^M_2 > 0, \pi^D_2 < 0
\\ \text{Occurs if} &: (\pi^M_1,\pi^M_2) \in [0,d] \times [0,d]
\intertext{Creates problems for GMM and ML estimation}
\end{align*}

\sideimage{EMC-L10-S7.png}{EMC-L10-S12}

### Econometric Model
\newcommand{\meanpi}{\bar{\pi}}
\newcommand{\meanpiM}{\meanpi^M}
\newcommand{\meanpiD}{\meanpi^D}

#### Set-Up

\begin{align*}
\intertext{2 firms, $j=1,2$, $k \neq j$}
\pi_j &= 
  \begin{cases}
   0                           & \text{if } a_j = 0 
\\ \meanpiM_j(x,z_j) + \eps_j  & \text{if } a_j = 1, a_k = 0 
\\ \meanpiD_j(x,z_j) + \eps_j  & \text{if } a_j = 1, a_k = 1
  \end{cases}
\intertext{Firm profits depend on mean profits $\meanpi$, and firm specific fixed cost shock $\eps_j$: i.i.d drawn from known distribution}
\intertext{Panel Data: $\{ a_{1mt},a_{2mt}, x_{mt}, z_{jt} \} $ over mkts m=1:M, periods t=1:T, firms j=1,2}
   \meanpiM_j(x_{mt},z_{jt}) &= x_{mt} \B + z_{jt}\gam + \eps_{jmt} 
\\ \meanpiD_j(x_{mt},z_{jt}) &= x_{mt} \B + z_{jt}\gam + \theta a_{kmt} + \eps_{jmt}
\\ \theta &: \text{ strategic parameter that governs firm k's entry ($a_{kmt} =1$) on firm j's profits}
\end{align*}

<!-- #### Example -->
<!-- \begin{align*} -->
<!-- \intertext{Example econmetric specification} -->
<!-- \pi_{jmt} &=  -->
<!--   \begin{cases} -->
<!--    0                           & \text{if } a_{jmt} = 0  -->
<!-- \\  x_{mt} \B + z_{jt}\gam + \eps_{jmt}   & \text{if } a_{jmt} = 1, a_{kmt} = 0  -->
<!-- \\  x_{mt} \B + z_{jt}\gam + \theta a_{kmt} + \eps_{jmt}  & \text{if } a_{jmt} = 1, a_{kmt} = 1 -->
<!--   \end{cases} -->
<!-- \intertext{Unique NE} -->
<!--    N=0        &: (a) \eps_1 < -\meanpiM_1; \ \eps_2 < -\meanpiM_2 -->
<!-- \\ N=1 (1,0)  &: (b1) \eps_1 > -\meanpiM_1; \ \eps_2 < -\meanpiM_2 -->
<!-- \\            &: (b2) \pi^M_1 > d, \pi^D_2 > 0; \ \pi^M_2 < d, \pi^D_2 < 0 -->
<!-- \\    (0,1)   &: (c1) \pi^M_1 < 0; \ \pi^M_2 > 0 -->
<!-- \\            &: (c2) \pi^M_1 < d, \pi^D_2 < 0; \ \pi^M_2 > d, \pi^D_2 > 0 -->
<!-- \\ N=2       &: (d)  \pi^D_1 > 0; \ \pi^D_2 > 0 -->
<!-- \intertext{Multiple NE; neither firm has dominant strategy to enter} -->
<!--    N=1        &: (e) \pi^M_1 > 0, \pi^D_1 < 0; \pi^M_2 > 0, \pi^D_2 < 0 -->
<!-- \\ \text{Occurs if} &: (\pi^M_1,\pi^M_2) \in [0,d] \times [0,d] -->
<!-- \end{align*} -->

 Unique NE | case | Firm 1 | Firm 2 | strategies
:----|:------:|:---------------------:|:---------------------:|:--------------
   N=0        | (a) | $\eps_1 < -\meanpiM_1$ | $\eps_2 < -\meanpiM_2$ | DE S.D. for both
   N=1        |(b1) | $\eps_1 > -\meanpiM_1$ | $\eps_2 < -\meanpiM_2$ | DE S.D. for 2 
   (1,0)      | (b2)| $\eps_1 > -\meanpiD_1$ | $-\pi^M_2  < \eps_2 < -\pi^D_2$ | E S.D for P1
   N=1        | (c1)| $\eps_1 < -\meanpiM_1$ | $\eps_2 > -\meanpiM_2$ | DE S.D. for 1
   (0,1)      | (c2)| $-\pi^M_1  <\eps_1 < -\pi^D_1$ |  $\eps_2 > -\meanpiD_2$ | E S.D. for P1
   N=2        | (d) | $\eps_1 > -\meanpiD_1$ | $\eps_1 > -\meanpiD_1$ | E S.D. for both
Multiple NE   | | | |
   N=1        |(e) | $-\pi^M_2  <\eps_2 < -\pi^D_2$ | $\text{ and } -\pi^M_1  <\eps_1 < -\pi^D_1$ | no S.D. strategies (0,1) or (1,0)

<!-- \image{EMC-L10-S12}{0.8}{NE in shocks} -->

#### Specification w/ multiple eqlbria

Can't construct a likelihood function

* for NE = 1, revelant range of epsilon in PDF is not clear. 
* could specify a unique eqlbm for the Multiple NE case (but lose predictions)
* ambiguous mapping from inequalities to eqlbm outcomes
* gets worse with more heterogenous firms (e.g j=1:N)

Solutions:

a) aggregate outcomes
     - predict how many firms enter
     - cases (b1,b2,c1,c2,e) all form the same event, so likelihood can be constructed
     - similiar to \tcite{Bresnahan and Reiss (1991)} homogenous game set-up
     - limits ability to identify heterogeneity in variable profits, or entry costs (what's the point)
b) "Efficient entry models" \tcite{Berry, 1992}
     - Flight routes
     - Economies of scope
     - sequential entry with SPNE

\image{EMC-L10-S16}{0.5}{Aggregate outcomes}

## Multiple Equilibria: sequential entry

Reference: Berry, S. (1992): “Estimation of a Model of Entry in the Airline Industry”, Econometrica

Data: 

* city pair routes for U.S. cities
     - counting on origin and destinations, ignoring intermediate connections
     - m = 1:1219 city-pairs in the sample
     - entry/exit over t = 1980Q1, 1980Q3
     - entry: not in mkt at start yr (Q1), in mkt at end of yr Q3
     - exit: in mkt Q1, not in mkt at Q3
     - entry rate is 20%, exit rate is 14%
     
### Reduced Form regression for mkt size in Q3

\begin{align*}
\intertext{Estimate how $N_i$ no. of airlines serving city-pair $i$ in Q3 varies with mkt characteristics}
   N_i &= \B_0 + \B_1\text{Pop}_i + \B_2 \text{Dist}_i + \beta_3 \text{Dist}^2_i + \B_4 \text{Tourist}_i + \B_5 \text{CityN2}_{i} + \B_6 \text{CityN1}_{i}+  \eps_i
\\ \text{Pop}_i &: \text{population of 2 cities on route of mkt i}
\\ \text{Dist}_i &: \text{distance btwn 2 cities for mkt i}
\\ \text{Tourist}_i &: \text{dummy for if either cities are in California or Florida}
\\ \text{CityN2}_i &: \text{no. of potential entrants who have active routes in both cities in mkt i}
\\ \text{CityN2}_i &: \text{no. of potential entrants who have active routes in one city in mkt i}
\end{align*}


### Reduced-form Probit for entry decisions in Q3

\begin{align*}
\intertext{Firm k's entry decisions into mkt i in 1980 Q3}
\text{enter}^{*}_{ki} &= \B_0 + \B_1\text{Pop}_i + \B_2 \text{Dist}_i + \beta_3 \text{Dist}^2_i + \B_4 \text{Tourist}_i + \B_5 \text{City2}_{ki} + \B_6 \text{CityShare}_{ki} + \B_7\text{no. of routes}_{ki} + \eps_{ki}
\\ \text{enter}_{ki} &= \begin{cases}
1 &\text{if } \text{enter}^{*}_{ki} > 0 
\\ 0 &\text{otherwise}
\end{cases}
\\ \text{Pop}_i &: \text{population of 2 cities on route of mkt i}
\\ \text{Dist}_i &: \text{distance btwn 2 cities for mkt i}
\\ \text{Tourist}_i &: \text{dummy for if either cities are in California or Florida}
\\ \text{City2}_i &: \text{dummy if potential entrant has other routes involving both cities for mkt i}
\\ \text{CityShare}_i &: \text{mean value of output share (in passenger miles) across two cities in mkt $i$}
\\ \text{no. of routes}_i &: \text{mean value of number of destinations served out of the origin and estination cities}
\end{align*}

### Structural entry model w/ firm heterogeneity

* general entry model w/ firm heterogeneity
* applied to airlines
* structural interpretation of "hub and spoke" networks
     - If already operate flights in a particular city, then the fixed costs to entering additional markets (city-pair) involving that city are lower
* Reduced forms just estimate entry decisions

#### Payoffs
\begin{align*}
\intertext{Variable Profits: same for all firms operating in mkt i}
   v_i(N_i) &= x_i \B - \delta \ln (N_i) + \rho u_{io}
\\ x_i &: [\text{Constant} \text{Pop}_i \text{Dist}_i]
\\ N_i &: \text{ current no of firms in mkt i}
\\ u_{io} &: \text{ mkt i specific shock affecting all firms profits (i.i.d std normal)}
\\ [\B \delta \rho] &: \text{ parameters; $\rho$ estimateable, and governs degree of correlation btwn entry decisions (group level shocks)}
\intertext{Fixed Costs: firm-k specific portion of profits for operating in mkt i}
\phi_{ik} &= z_{ik} \A + \sigma u_{ik}
\\ z_{ik} &: [\text{City2}_{ik} \ \text{CityShare}_{ik}]
\\ u_{ik} &: \text{ mkt i, firm k idiosyncratic shock (i.i.d std normal)}
\\ [\A,\sigma] &: \text{parameters, $\sigma$ can't be identified so normalised to 1}
\intertext{Firm k's total profits from entering mkt i}
\pi_{ik} &= \undersetbrace{\text{VC}}{v_i(N_i)} + \undersetbrace{\text{FC}}{\phi_{ik}}
\\ &= \undersetbracetext{data, parameters}{x_i \B - \delta \ln (N_i) +  z_{ik} \A} + \undersetbracetext{shocks}{\rho u_{io} + \sigma u_{ik}}
\intertext{All firm heterogeneity enters through "fixed costs" $\phi_{ik}$}
\end{align*}

#### Eqlbm entry

* SPNE of:
     a) "efficient entry": most profitable firms enter first
     b) incumbents go first, new entrants second
* SPNE depend on fixed costs:
     - $u_{ik}$ increases firm inefficiency, so smaller shocks mean earlier entry
     
#### Estimation of Efficient Entry

Algorithm

<!-- \begin{align*} -->
<!-- \intertext{For market i} -->
<!-- \intertext{1. Draw K i.i.d $u_{ik}$ fixed cost shocks for K firms} -->
<!-- \intertext{2. Derive and order firm fixed cost fncs to get entry order; K-most efficient, 1-least efficient} -->
<!--    \phi_{ik} &= z_{ik} \A + \sigma u_{ik} -->
<!-- \\ \phi_{i1} > \phi_{i2} > \dots > \phi_{iK} -->
<!-- \intertext{3. Estimate threshold for no. of entrants under NE ($N^{*}_i$), with following 2 conditions} -->
<!--    \pi_{ik}(N^{*}_i) > 0  -->
<!-- \\ \pi_{ik}(N^{*}_i + 1) < 0 -->
<!-- \intertext{4. Iteration will show that $K$ to $(K-N^{*}_i)$ efficient firms will enter, and all less efficient firms afterwards will not} -->
<!-- \end{align*} -->

\TK{current no. of firms refers to Q1; EMC-L10-S27}
\TK{SPNE iteration; is $N^{*}_i$ number of firms?; EMC-L10-S30}

Method

- ML generally intractable due to dimensionality (more entrants = more intergrals)
- Use GMM instead

\begin{align*}
\intertext{INNER LOOP: R simulations across M mkts}
\intertext{1. Predict SPNE $N^{*}_i$ for mkt i, with R simulations}
\intertext{1a. Draw R vectors of $K \times 1$ i.i.d $u_{ik}$ fixed cost shocks for K firms, and R scalar mkt level shocks $u_{io}$, fixed for entire routine}
      u^R_{ik} &= \{u^r_{ik}\}_{k=1}^K
   \\ u^R_{io} &= \{ u^r_{io} \}
\intertext{1b. For each simulation r=1:R, order firms by fixed cost shock, and fixed cost variables (all scaled by common $\A$)}
   \phi^R_{ik} & = \{ \phi^r_{ik} = z_{ik} \A  + u^r_{ik} \}_{k=1}^K  
\\ \text{ordered most to least efficient} &: \phi_{i1} > \phi_{i2} > \dots > \phi_{iK}
\intertext{1c. For each simulation r=1:R, simulate no. of entrants $N^{*r}_i$}
\intertext{Add firms until NE conditions hold}
   \pi_{ik}(N^{*}_i) &> 0 
\\ \pi_{ik}(N^{*}_i + 1) &< 0
\\ \pi_{ik} &= \undersetbrace{\text{VC}}{v_i(N_i)} + \undersetbrace{\text{FC}}{\phi_{ik}}
\\ &= \undersetbracetext{data, parameters}{x_i \B - \delta \ln (N_i) +  z_{ik} \A} + \undersetbracetext{shocks}{\rho u_{io} + \sigma u_{ik}}
\intertext{1d. Average over simulations to get estimated no. of entrants (Monte-carlo estimate of SPNE)}
   \hat{N}_i(x_i,z_{ik},\theta) &= \frac{1}{S} \sum_{s=1}^R N^{*r}_i
\intertext{2. Repeat 1a-d for all mkts i=1:M}
   \{ \hat{N}_i(x_i,z_{ik},\theta) \}_{i=1}^M
\intertext{3. Compute prediction errors for all mkts i=1:M; no structural interpretation, can't perfectly rationalise}
   \{ \xi_i = N_i - \hat{N}_i \}_{i=1}^M
\intertext{OUTERLOOP: GMM}
\intertext{1. Define and minimise GMM objective function, (minimise prediction errors)}
   \hat{\theta} &= \underset{\theta}{\arg\min} \left[ \frac{1}{M} \sum_{i=1}^M w'_i \xi_i  \right]' W \left[ \frac{1}{M} \sum_{i=1}^M w'_i \xi_i  \right]
\\ w_i &= [ x_i, z_i ] 
\intertext{assumed to be orthogonal to the prediction error of SPNE (all dependent are exogenous variables)}
\\ W &= \left( \sum_{i=1}^M w'_i w_i  \right)^{-1}
\end{align*}



***

# A4: Endogenous Entry and Product Quality, Mazzeo (2002)
Reference: Mazzeo, M.J. (2002): “Product Choice and Oligopoly Market Structure”, Rand Journal of Economics, vol. 33, p. 221-242.

* Empirical model of product differentiation and oligopoly mkt structure
      - endogenous product-type choice
      - competitive effects of product-type choice and entry
      - incorporate different specification of strategic product choice game
      - Firms enter the market if their margins are high enough to cover fixed costs and select the profit-maximizing product type, knowing that margins fall with the entry of additional firms and may depend on the relative product space location of competitors.
* Application: oligopoly motel markets along U.S. interstate highways; 
      - differentiation according to quality (high, low; high, med, low)
      - predict no. of entrants, and product type choice of each entrant
* Context: 
      - firms have incentive to differentiate to reduce substitutability
      - But also have incentive to enter into undifferentiated product with high demand
      - outcomes may depend on simultaneous or sequential choice; if choice is committed or can change after observing other firm's choices

## Endogenous Product choice eqlbm model

Payoff function
\begin{align*}
\pi_{Tm} &= X_m \B_T + g(\theta_T;\vec{N}) + \eps_{Tm}
\\ X_m \B_T &: \text{market demand effect on profits; where effect of demand characteristics varies with type}
\\ g(\theta_T;\vec{N}) &: \text{strategic effect of number and type of competitors}
\\ \vec{N} &: \text{vector of competiting firms of each type}
\end{align*}

Eqblm concept
\begin{align*}
\pi_L(L-1,H) > 0 & \pi_H(L,H-1) > 0
\\ pi_L(L,H) < 0 & \pi_H(L,H) <0
\\ \pi_L(L-1,H) > \pi_H(L-1,H) & \pi_H(L,H-1) > \pi_L(L,H-1)
\end{align*}
# L11: Production Functions
Recommended reading: Ackerberg, Benkard, Berry and Paskes (2006), Ch 2

## Overview

* prod fnc: transform inputs in outputs for organisations
     - measure productivity, and productivity growth
     - sources of entry/exit
     - complementarity/substitutability btwn inputs
     - economics of scale/scope
     - policies affecting productivity (trade liberalisation)
     
* Econometric issues:
     a) Data problems
           - firm level data not available
           - measurement of output, value of capital, quality of labour is difficult
     b) Model specificiation 
           - different fnc forms
           - different types of labour/capital inputs
           - constrains choice of estimation parameters 
           - Focus here on **Cobb-Douglas**
     c) ***Endogeneity of inputs***
           - input choice is likely correlated with unobserved inputs, or firm productivity shocks (e.g. managerial quality, quality of land)
           - more productive firms might have higher MPk, and employ more capital
     d) Multicollinearity
           - firms' input choices are highly correlated across and within firms (mkt wages, std process)
     e) ***Endogenous firm exit/entry or selection***
           - For firm panel data, exit from sample is not exogenous/random
                - smaller firms, and firms with high L:K ratio are more likely to exit 
                - firms with lower unobs'd productivity are also more likely to exit
           - endogeneity of entry/exit creates selection bias in production function parameter estimates \TK{positive bias due to selected sample of higher performing companies}
           
## Basic Example: Cross Section, Cobb-Douglas log OLS

#### Set-Up
__CS Data__: 
      
- cross section of i=1:N firms, with variables $\{Y_i, L_i, K_i\}_{i=1}^N$, 
- observed for each firm at cross-section period.
      
__Model__: Cobb-Douglas Production Function:
      
- $Y_i = \undersetbrace{A_i}{e^{\om_i+\eps_i}} L_i^{\A_L} K_i^{\A_K}$
- $\om_i$: Total Factor Productivity, unobserved productivity (shock) 
       - Unobserved firm inputs: managerial quality, input quality, 
- $\eps_i$: Measurement error of output, and random shocks
       - random shocks to productivity, unknown to firms when making input choices
       - not associated with unobservables

#### Identification
__Endogeneity Problem__:

- log prod func: $y_i = \A_L l_i + \A_K k_i + \om_i + \eps_i$
- estimation parameters: $\A_L, \A_K$
        - biased if: $\om_i$ known to firms during input choice. 
        - $(l_i,k_i), \om_i$ are correlated
        - Then $E[l_i \om_i], E[k_i \om_i] \neq 0$
- example with Labour input:
        - suppose competitive markets, homogenous inputs and outputs
        - suppose $\om_i, \eps_i$ are observed before choosing labour
        - In SR, profit-max firms choose $l_i$ : MP_L = wage ($w_j$):
        \begin{equation*}
        L_j = \left[ \frac{p_j}{w_j} \B_L e^{\om_i+\eps_i} K_j^{\A_K} \right] \frac{1}{1-\A_L}
        \end{equation*}
        - taking logs, $l_i$ is correlated with $\om_i$ through firm i's FOC above. 
- Empirically, labour has more endogeniety bias than capital
        - labour is more easily adjustable, correlates more strongly with  $\om_i$ than capital, which takes longer to adjust
              
__Solution__:   
Instrument for input choice using ___Input Prices___

 a) Validity
         - exclusion: assume uncorrelated with $\om_i$
         - relevance: more expensive inputs, decrease use of inputs regardless of productivity shock $\om_i$
 b) Limitations
         - input prices often not available at firm level
         - for firms in homogenous input and output markets, ofen very little cross-sectional variation in input prices btwn firms
         - for firms in different input markets, may get cross-sectional variation BUT rental price differences may be correlated with productivity. This causes $E[\om_i r_i], E[\om_i k_i] \neq 0$.
  

## Case study: Panel data w/ fixed effect estimator
Reference: Mundlak (1961) and Mundlak and Hoch (1965)

### Set-Up
__Panel Data__: panel for i=1:N firms, for t=1:T periods, with variables $\{Y_i, L_i, K_i\}_{i=1,t=1}^{N,T}$  
__Prod Func (log)__:   $y_{it} = \A_L l_{it} + \A_K k_{it} + \om_{it} + \eps_{it}$  

### Econometric Assumptions

i. TFP: $\om_{it} = \eta_i + \delta_t + \om^{*}_{it}$  
      - $\eta_i$: firm specific productivity effect (e.g. managerial ability)
      - $\delta_t$: aggregate productivity shock,  \TK{observed by all firms (but not econometrician); ignore period specific unobservables which period dummies can control for L11-S11 ?? Not everything can be solved with fixed effects}
      - $\om^{*}_{it}$ is an idiosyncratic shock
ii. $\om^{*}_{it}$ is realised after firms choose inputs; i.e. unobserved to firms, so not correlated with choice
iii. $\om^{*}_{it}$ not serially correlated; no persistence in shock
iv. inputs for firm i exhibit some time variation such that $var(l_{it} - \bar{l}_{it}) > 0$ (for $k_{it}$ also)

### Estimation: Within-firm (fixed effects) estimator  

* fixed effects esitmators for $\A_K, \A_l$ are consistent under above assumptions:
\begin{gather*}
(y_{it} - \bar{y}_{i}) = \A_L(l_{it} - \bar{l}_{i}) + \A_K(k_{it} - \bar{k}_{i}) + (\om_{it} - \bar{\om}_{i}) + (\eps_{it} - \bar{\eps}_{i})\\
\intertext{or use following regression}
y_{it} = \A_L l_{it} + \A_K k_{it} + \sum_{i=1}^N \gam_i \underset{\text{firm dummy}}{d_i} + \om^{*}_{it} + \eps_{it}
\end{gather*}
* consistency relies on $z_{it} = (l_{it},k_{it})$ is strictly exogenous to productivity shocks.  
For any period t,s: $cov(z_{it},\om^{*}_{is}) = cov(z_{it}, \eps_{is}) = 0$  

__Limitations__:  

* Fixed effects tend to provide small estimates of $\A_K, \A_L$ \tcite{Grilliches and Mairesse, 1998}
* Assumptions ii. and iii. are unrealistics; firms observe within-period productivity shocks, which are also persistent
* Assumption i. that firm specific unobservable $\eta_i$ is fixed/time-invariant is also suspect across long periods (learning, improvements)
* Useful mostly as first pass
      
## Case study: Dynamic Panel w/ First Differences Model
Reference: Arellano and Bond (1991)

### Prod Func (first diff): 
\newcommand{\ydiff}{\Delta y_{it}}
\newcommand{\ldiff}{\Delta l_{it}}
\newcommand{\kdiff}{\Delta k_{it}}
\newcommand{\omdiff}{\Delta \om^{*}_{it}}
\newcommand{\epsdiff}{\Delta \eps_{it}}
\begin{gather*}
\ydiff = \A_L \ldiff + \A_K \kdiff + \omdiff + \epsdiff
\\ \omdiff = \om^{*}_{it} -  \om^{*}_{it-1}
\end{gather*}

\TK{Where does $\Delta \delta_{t}$ go?? }

### Assumptions:

Relax strict exogeneity condition (ii)

i. TFP: $\om_{it} = \eta_i + \delta_t + \om^{*}_{it}$  
ii. $\om^{*}_{it}$ is realised ___BEFORE___ firms choose inputs; i.e. unobserved to firms, so not correlated with choice
iii. $\om^{*}_{it}$ not serially correlated; no persistence in shock
iv. inputs for firm i exhibit some time variation such that $var(l_{it} - \bar{l}_{it}) > 0$ (for $k_{it}$ also)
vi. adjustment costs in at least one input
\begin{align*}
l_{it} &= f_L(l_{it-1}, k_{it-1}, \om_{it})
\\ k_{it} &= f_K(l_{it-1}, k_{it-1}, \om_{it})
\\ & \pd{f_L}{l_{it-1}}, \pd{f_L}{l_{it-1}} \neq 0
\\ \text{and.or}& \pd{f_L}{k_{it-1}}, \pd{f_L}{k_{it-1}} \neq 0
\end{align*}

### Identification:

* $l_{it-\tau}, k_{it-\tau}, y_{it-\tau}, \tau \geq 2$ are valid instruments for identification in first differences
      - relevance: $corr(\{ l_{it-\tau}, k_{it-\tau}, y_{it-\tau}\}, \{ \ldiff, \kdiff \}) > 0$
      - exclusion: no serial correlation in $\om^{*}_{it}$; going back two periods is sufficient for exclusion

### Estimation:
#### a) 2SLS estimation
  - suppose $z_{it-2} = (l_{it-2},k_{it-2})$ are IV's for $(\ldiff, \kdiff)$
  - just identified, so $\A_K, \A_L$ can be estimated by 2SLS

#### b) GMM estimation
  - suppose want to use more instruments based on 
         (1) higher order lags of input (more than 2)
         (3) higher order lagged dependent variable (output)
  - creates overidentified restrictions

\begin{align*}
\text{Differenced Eqn} &:\ydiff = \A_L \ldiff + \A_K \kdiff + \omdiff + \epsdiff
\\ \text{Parameters} &: \theta = [\A_L,\A_K]'
\\ \text{Unobservables} &: [\omdiff + \epsdiff] = \ydiff - (\A_L \ldiff + \A_K \kdiff)
\\ \text{Instruments} &: z_{it-j} = (l_{it-j},k_{it-j}), \quad j \geq 2
\\                    &: y_{it-j}
\\ \text{Pop. Moments} &: E[z'_{it-j}[\omdiff + \epsdiff]] = 0; \quad \text{j=2:$\tau$}
\\               &: E[y_{it-j}[\omdiff + \epsdiff]] = 0; \quad \text{j=2:$\tau$}
\\ \text{Sample Analog for lag j} &: \frac{1}{NT} \sum_i^N \sum_i^T z'_{it-j}[\undersetbrace{[\omdiff + \epsdiff]}{(\ydiff - \A_L \ldiff + \A_K \kdiff)}] 
\\ & \quad = \frac{1}{NT} \sum_i^N \sum_i^T g_j(z_{it-j},\theta) = 0
\\               &: \frac{1}{NT} \sum_i^N \sum_i^T y_{it-j}[\undersetbrace{[\omdiff + \epsdiff]}{(\ydiff - \A_L \ldiff + \A_K \kdiff)}] 
\\ & \quad = \frac{1}{NT} \sum_i^N \sum_i^T h_j(y_{it-j},\theta) = 0
\\ \text{Stacked sample moments j=2:$\tau$} &: G(z_{it},y_{it-j},\theta) 
\\ & \quad = [g_j(z_{it-2},\theta),\dots,g_j(z_{it-\tau},\theta), \ h_j(y_{it-2},\theta),\dots,h_j(y_{it-\tau},\theta)]'
\\ \text{GMM Obj. Fnc} &: Q(\theta,z,y) 
\\ & \quad = \left[ \frac{1}{NT} \sum_i^N \sum_i^T G(z_{it},y_{it-j},\theta) \right]' W \left[ \frac{1}{NT} \sum_i^N \sum_i^T G(z_{it},y_{it-j},\theta) \right]
\\ \text{GMM estimator} &:
\underset{\theta}{\arg\min} Q(\theta,z,y)
\end{align*}

- post estimation test for serial correlation using AR(p) model, with lags 1:p
$\hat{\om^{*}_{it}} = \rho_1 \hat{\om^{*}_{it-1}} + \dots +  \rho_p \hat{\om^{*}_{it-p}} + u_{it}$

### Applications and Limitations
* Deal well with endogeneity of regressors, using lags (with assumption of adjustment costs or similar intuition)
* But selection bias is still an issue

# L12: Productivity
Reference: Olley, S., and A. Pakes (1996): “The Dynamics of Productivity in the Telecommunication Equipment Industry” Econometrica, 64, p. 1263-1297.

## Model
### Set-up
__Panel Data__: panel for i=1:N firms, for t=1:T periods, with variables $\{Y_i, L_i, K_i\}_{i=1,t=1}^{N,T}$  
__Prod Func (log)__:   $y_{it} = \A_L l_{it} + \A_K k_{it} + \om_{it} + \eps_{it}$  

In each period $t$:

- state variables are ($k_{it}, \om_{it}$)
- for given state, firms compares:
    i. $V(k_{it}, \om_{it})$: value of continuing production
    ii. $S(k_{it}, \om_{it})$: fire-sale value of exiting
- firms make endogenous decisions (control variables)
    i. $i_{it} \in \mathbb{R}$: Strategic investment (continuous amount), \TK{maximises V}
    ii. $\chi_{it} \in \{0,1\}$: Continue/Exit market, \TK{1 if S > V}

### Assumptions
1. Productivity evolves as a **first order Markov process**: $\om_{it+1} \sim F(\cdot \vert \om_{it})$
2. Inputs:
     a. Labour is non-dynamic input. 
           - Non-strategic choice, doesn't affect future, choosen to minimise costs
     b. Capital is a dynamic input, evolves according to: \begin{align*}
     k_{it} &= K(k_{it-1},i_{it-1})
     \\ &= (1-\delta)k_{it-1} + i_{it-1}
     \end{align*}
           - **time to build** assumption, where firm i's investment choices in $t-1$ only become productive as $k_{it}$ in period $t$
3. Firms are:
     - forward looking
     - compete over discrete time, infinite horizon
     - maximise NPV of profits


### Results
3. Given $k_{it}$, optimal investment decision are **strictly monotone** in productivity: 
\begin{gather*}
i_{it} = f_t(\om_{it},k_{it}); \qquad \pd{f_t(\om_{it},k_{it})}{\om_{it}}
\end{gather*}
      * function $f_t(\cdot)$ can change over time, which allows for changes in mapping due to macro conditions
      * given monotonicity, $f_t{\cdot}$ can be inverted to recover unobs productivity
      \begin{gather*}
      \om_{it} = f_t^{-1}(i_{it},k_{it})
      \end{gather*}
4. Firm i does not exit if $V(k_{it}, \om_{it}) > S(k_{it}, \om_{it})$
      * for given $k_{it}$, this implies a threshold level of productivity ($\underline{\om}_{it}$):
      \begin{align*}
      \chi_{it} &= \begin{cases}
      1 &\text{if } \om_{it} \geq \underline{\om}_{it}(k_{it}) \\
      0 &\text{otherwise}
      \end{cases}
      \end{align*}

## Estimation

### Parameters $\A_L, \A_K$
\TK{EXAMPLE quadratic?? L12-S07}
\TK{$\hat{\eps_{it}}$ is orthogonal to inputs so doesn't impact consistency of $\A_k$ L12-S09}
\begin{align*}
\intertext{1. Estimate $\A_L$ using control function, with regressors as proxies for productivity rather than IVs}
y_{it} &= \A_L l_{it} + \A_K k_{it} + \om_{it} + \eps_{it} 
\\ &= \A_L l_{it} + \undersetbrace{\phi_t(i_{it},k_{it})}{\A_K k_{it} + f_t^{-1}(i_{it},k_{it})} + \eps_{it}
\\ &= \A_L l_{it} + \undersetbrace{\text{control fnc }}{\phi_t(i_{it},k_{it})} + \eps_{it}
\\ &= \A_L l_{it} + \sum_{m=0}^M \sum_{n=0}^N \gam_{mn}^t i^m_{it} k^n_{it} + \eps_{it}
\intertext{Functional form of control fnc is unknown, but can be approximated as higher order polynominal}
\phi_t(i_{it},k_{it}) &\approx \sum_{m=0}^M \sum_{n=0}^N \gam^t_{mn} i_{it}^m k_{it}^n 
%\\ \text{Example quadratic (M=2, N=2)} &:  y_{it} = \A_L l_{it} + \gam^t_{1,0} i_{it} + \gam^t_{0,1} k_{it} + \gam^t_{1,1} i_{it}k_{it} + \gam^t_{2,0} i_{it}^2 + \gam^t_{0,2} k_{it}^2  + \eps_{it} 
\intertext{2. Estimate $\A_K$, using time to build assumption}
\om_{it} &= \undersetbrace{\text{forecast}}{E[\om_{it}\vert \mathcal{I}_{it-1}]} + \undersetbrace{\text{forecast error}}{\xi_{it}}
\\ &= E[\om_{it}\vert \om_{it-1}] + \xi_{it}
\\ &= \undersetbrace{\text{unkwn fnc}}{h(\om_{it-1})} + \undersetbrace{\text{indpdnt shock}}{\xi_{it}}
\intertext{First-order Markov assumption implies that lagged productivity $\om_{it-1}$ is the only relevant information}
\text{From 1.} \quad \undersetbrace{\phi_{it}}{\phi_t(i_{it},k_{it}) + \eps_{it}} &= \A_K k_{it} +  \om_{it}
\\ \om_{it-1} &= \phi_{it-1} - \A_K k_{it-1}
\\ \text{From 2. assumption} \quad &= \A_K k_{it} + E[\om_{it}\vert \om_{it-1}] + \xi_{it}
\\ &= \A_K k_{it} + h(\om_{it-1}) + \xi_{it}
\\ &= \A_K k_{it} + h(\phi_{it-1} - \A_K k_{it-1}) + \xi_{it}
\intertext{Functional form of forecast is unknown, but can be approximated as higher order polynominal}
h(\hat{\phi}_{it-1} - \A_K k_{it-1}) &\approx \sum_{m=0}^M \pi^t_{m} (\hat{\phi}_{it-1} - \A_K k_{it-1})^m 
\end{align*}

### Regression Eqns
\begin{align*}
\intertext{First stage estimate, $\hat{\phi_{it}}$ includes $\hat{\eps_{it}}$}
y_{it} &= \hat{\A_L} l_{it} + \hat{\phi_{it}}
\intertext{Second stage estimate, $\hat{\eps_{it}}$ is orthogonal to inputs so doesn't impact consistency of $\A_k$}
\hat{\phi}_{it} &= \hat{\A}_K k_{it} + \sum_{m=0}^M \pi^t_{m} (\hat{\phi}_{it-1} - \A_K k_{it-1})^m + \hat{\xi_{it}}
\end{align*}

### Identification

Summary

$\A_L$| $\A_K$ 
 :-----------------:|:----------------------:|
 control function | forecast fnc | 
 regressors not IVs |time to build (lag)| 

\TK{Time to build assumption}

 \begin{align*}
 i_{it} &= f_t(\om_{it},k_{it})
%\\ i_{it-1} &=  f_t(\om_{it-1},k_{it-1})
 \\ \om_{it} &= h(\om_{it-1}) + \xi_{it}
 \\ k_{it} &= (1-\delta)  k_{it-1} + i_{it-1}
 \\ &= (1-\delta)  k_{it-1} + f_t(\om_{it-1},k_{it-1})
 \\ &= (1-\delta)  k_{it-1} + f_t(h(\om_{it-2}) + \xi_{it-1},k_{it-1})
 \intertext{$k_{it}$ is not a function of $\xi_{it}$, so $E[k'_{it}\xi_{it}] = 0$}
 \intertext{if no time to build, $k_{it-1}$ and $\xi_{it}$ become correlated}
 \\ k_{it} &= (1-\delta)  k_{it-1} + i_{it}
 \\ &= (1-\delta)  k_{it-1} + f_t(\om_{it},k_{it-1})
 \\ &= (1-\delta)  k_{it-1} + f_t(h(\om_{it-1}) + \xi_{it},k_{it-1})
\end{align*}

* $i_{it-1}$ is correlated with $\om_{it-1}$ but not $\xi_{it}$
* conditional on $\om_{it-1}$, $k_{it}$ is not correlated with $\xi_{it}$ by construction 
* If $i_{it}$ was immediately productive then $i_{it}$ would be correlated with $\xi_{it}$ implying $k_{it}$ is also correlated.
     - a little difficult to defend with annual frequency, but under monthly frequency time to build more reasonable

### Efficiency

* regressors tend to be highly multicollinear, so OLS estimates are imprecise
* GMM estimates improve efficiency

## Example: AR(1) productivity shocks

\begin{align*}
\om_{it} &= \rho \om_{it-1} + \xi_{it}
\\ E[\om_{it}\vert \mathcal{I}_{it-1}] &= E[\om_{it}\vert \om_{it-1}]
\\&= h(\om_{it-1})
\\&= \rho \om_{it-1}
\\&= \rho(\hat{\phi}_{it-1} - \A_K k_{it-1})
\intertext{form of $h(\cdot)$ is known}
\hat{\phi}_{it} &= \A_K k_{it} + \rho \hat{\phi}_{it-1} - \rho\A_K k_{it-1} + \xi_{it}
\end{align*}

# L13: Search & Price Dispersion

Recommended reading: Bellefame and Peitz, Chapter 7

* Take non-structural approach
* Theory of Consumer Search
* Empirical Analysis

## Theory of Consumer Search

### Motivation
* __Search costs__
    - relevant in many markets
    - e.g. consumers do not see all prices, job seekers do not see all wages
    - implies imperfect info over price/wage distributions
* __Market power__
    - search costs and asymmetric info create market power for firms
    - can obs price/wage dispersion in the real world if consumers/workers face search costs
* __Internet__
    - can potentially lower search costs (physical costs of gathering data)
    - but can also increase variety of products/jobs (increases cognitive cost of comparison)
    
### Bertrand Paradox

##### Homogenous Bertrand Model
* i=1:2 identical firms
      - compete to sell identical products at $p_i$
      - same constant MC $c_1 = c_2 = c$
      - consumers all purchase from lowest-price firm
      - both firms able to supply entire market at any price level (no capacity constraints) 
      - demand split 50-50 if $p_1 = p_2$

##### Unique NE: $p_1 = p_2 = c$
* paradox is a useful benchmark
      - only takes 2 firms to dissipate all rents in a homogenous product market
      - no price dispersion
* consumer search helps resolve paradox

## Model of Sales
Reference: Varian, H. (1980): “A Model of Sales,” American Economic Review, 70(4), 651-659.

#### Summary of Set-Up and Results
* __Firm Competition__:
     - identical firms
     - homogenous products
     - compete a la Bertrand
* __Incomplete Information__:
     - some consumers become informed and purchase from lowest-priced firm
     - others remain uninformed, and purchase from random firm
     - consumers pay search costs to become informed, endogenously determining share of informed and uninformed
     - deep primitive underneath price sensitivity coefficient ($\A$)
* __Results__:
     - no PSNE, focus on MSNE
     - under MSNE, price dispersion arises for identicial products

\newcommand{\plower}{\underline{p}}  
\newcommand{\informed}{\lambda^I}
\newcommand{\uninformed}{1-\informed}
\newcommand{\uninfcustomers}{\lambda^U}
1. Supply: MSNE
\begin{align*}
\intertext{Symmetric NE}
F(p) &= \begin{cases}
0 & \text{for } p < \plower \\
1 - \left(\frac{\pi_f(p)}{\pi_f(p)-\pi_s(p)}\right) ^{\frac{1}{n-1}} & \text{for } p \in [\plower,r] \\
1 & \text{for } p > r
\end{cases}
\intertext{with free-entry condition for all $p$}
0 &= \pi_s(p) \times (1-F(p))^{n-1} + \pi_f(p) \times (F(p))^{n-1} 
\\ \pi_s(p) &= \undersetbrace{TR}{p(\uninfcustomers + \informed)} - \undersetbrace{TC}{C(\uninfcustomers + \informed)}
\\ \pi_f(p) &= p \uninfcustomers - C(\uninfcustomers)
\end{align*}

2. Demand: Optimal search behaviour
\begin{align*}
\text{Value of Search} &: V_I = \int_{\plower}^r p f(p) dp -  \int_{\plower}^r p(1-F(p))^{n-1}f(p)dp
\intertext{Shop if $V_I - s_i \geq 0$}
\text{$\mu$ Shoppers} &: s_i = 0 \Rightarrow V_I - s_i > 0
\\ \text{$1-\mu$ Non-shoppers} &: s \sim g(s); s \in [0,\bar{s}]
\\ \text{indifferent non-shopper} &: V_I - \tilde{s} = 0
\intertext{Implied search intensities}
\informed &= \mu + (1-\mu)\cdot G(\tilde{s})
\\ \uninfcustomers &= \frac{1-\informed}{n}
\end{align*}

#### Supply set-up: exog. demand
* Exogenous Demand
      - unit inelastic demand
      - $r$: reservation price; all consumers only purchase if $p < r$
      - $\informed \in [0,1]$: informed consumers (population share via normalisation to 1)
      - $\uninformed$: uninformed consumers (shares normalisation, carries over to q, \TK{each consumer buy same amount})
* Supply
      - monopolisitically competitive market
      - free entry by symmetric firms
      - homogenous products
      - increasing returns to scale industry 
* Firms
      - decreasing average costs $C(q) = cq + f$ 
      - $n$ identical firms
      - determined by free entry condition $\pi^e(n) = 0$ (entry game)
      - $\uninfcustomers = \frac{\uninformed}{n}$ uninformed customers per firm (since all must make same zero profits)
      - no price discriminiation btwn informed/uninformed customers
      - pricing low for informed necessary means losing intensive margin on uninformed, pricing high for higher margin on uninformed means losing extensive margin of informed customers

#### Nash Equilibrium

Focus on symmetric NE where all firms choose same F(p)
\begin{align*}
\text{CDF} &: F(p) \in \mathcal{R}_{+}
\\ \text{PDF} &: f(p) = dF(p)
\\ \text{PSNE $p=10$} &: f(10) = 1
\\ \text{MSNE $(10,20) (\frac{1}{2},\frac{1}{2})$} &: f(10) = 0.5, f(20) = 0.5, f(\backslash \{10,20\}) = 0
\end{align*}

Characterisation of F(p)

1. Find lower bound 
     - best case scenario of serving all informed and share of uninformed $\informed + \uninfcustomers$
     - must charge at least average cost otherwise profits are negative 
     - $\underset{\text{AR}}{\plower} = \underset{\text{AC}}{\frac{C(\informed + \uninfcustomers)}{\informed + \uninfcustomers}}$
     - NE: $F(p) = 0 \ \forall \ p < \underline{p}$, excludes $\underline{p}$ since no incentive to deviate from $\pi(\plower) = 0$
2. Find upper bound
     - no purchases by either type of consumer if price above reservation price, so never charge above $r$
     - NE: $F(p) = 1 \ \forall \ p > r$, excludes $r$ because consumers will purchase at reservation price
3. Prove no symmertic PSNE
     - 1 & 2 combined to imply any NE prices must lie in $[\plower,r]$
     a) **Case 1**: $p* \in (\plower,r]$
          - have incentive to undercut towards $\plower$ and gain all informed consumers
     b) **Case 2**: $p* = \plower$
          - firms will be splitting informed consumers $\frac{\informed}{n} + \uninfcustomers < \informed + \uninfcustomers$
          - Recall, $\plower$ is avg cost for the best case scenario without splitted informed customers (i.e. serving all informed customers)
          - Firms will have fewer customers in this NE than under the lower bound case used to calculate $\plower$
          - Avg cost are increasing as the number of customers served decreases, but avg rev is at $\plower$
          - $\frac{C(\frac{\informed}{n} + \uninfcustomers)}{\frac{\informed}{n} + \uninfcustomers} > \plower = p*$
          - implies negative profits, giving firms incentives to deviate and leave the market, since the zero profit free entry/exit condition is contradicted
4. \TK{Prove no mass points}
      - if there was any price that was played with positive probability by all firms, implies possibility of a tie between all firms
      a) **Case 1**: tie at $p* > \plower*$
           - firms have an undercutting incentive, shifting the probability at that tied price to a lower price $\tilde{p}$ towards $plower$ 
           - no mass points because $\tilde{p}$ is a profitable deviation $p* > \tilde{p} > \plower$
      b) **Case 2**: tie at $\plower$
           - creates probability that firms will make negative profits, so have incentive to shift probability to higher $\tilde{p}$ and profit from uninformed customers
5. Derive expected profits for given symmetric NE F(p)

\begin{align*}
\text{Pr(cheapest firm)} &= (1-F(p))^{n-1}
\\ \text{"success" profits if cheapest} &: \pi_s(p) = \undersetbrace{TR}{p(\uninfcustomers + \informed)} - \undersetbrace{TC}{C(\uninfcustomers + \informed)}
\\ \text{"failure" profits} &: \pi_f(p) = p \uninfcustomers - C(\uninfcustomers)
\\ \text{Expected Profits} &: E_{F(p)}[\pi_i]
\\  &= \int_{\plower}^r [\pi_s(p) \times (1-F(p))^{n-1} + \pi_f(p) \times (1-(1-F(p))^{n-1})]f(p)dp
\end{align*}
          
6. Characterise Symmetric MSNE
       - all prices $p \in [\plower, r]$ are chosen with positive probability, with likelihood $f(p) > 0 \ \forall \ p$
       - all potential prices in $F(p)$ must yield same profits otherwise it would be profitable to increase frequency of more profitable prices; i.e. probability measure of F(p) is not NE.
       - same profit level must be ZERO because of free-entry condition:  
       \begin{align*}
       \pi_s(p) \times (1-F(p))^{n-1} + \pi_f(p) \times (1-(1-F(p))^{n-1}) = 0
       \\ 1 - F(p) = \left(\frac{\pi_f(p)}{\pi_f(p)-\pi_s(p)}\right) ^{\frac{1}{n-1}}
       \intertext{RHS is strictly decreasing in $p$ because avg costs are decreasing in $q$}
       \end{align*}

7. Eqlbm price distribution
\begin{align*}
F(p) &= \begin{cases}
0 & \text{for } p < \plower \\
1 - \left(\frac{\pi_f(p)}{\pi_f(p)-\pi_s(p)}\right) ^{\frac{1}{n-1}} & \text{for } p \in [\plower,r] \\
1 & \text{for } p > r
\end{cases}
\end{align*}

- Full range [$\plower, r$] are offered with likelihood $f(p) >0$
      a) $p > \plower$ 
           - must be offered such that $F(\plower + \eps) > 0, \ \forall \ \eps > 0$
           - If not, then a firm could profitably under cut and steal all informed consumers
      b) $p < r$
           - must be offered such that $F(r - \eps) > 0$
           - IF not, firms at the upper bound $\tilde{p}$ could be charging a higher price, and getting more profit since they are not the lowest priced firm and will only get uninformed consumers. 

\image{EMC-L13-S15}{0.4}{From Varian 1980: p* is $\plower$}


#### Endogenous Demand-side Information search

- suppose there is a clearinghouse, to which consumers pay a price and the entire price distribution is revealed to them. 
- Two types of consumers:
\begin{align*}
\text{value of search} &: V_I = \int_{\plower}^r p f(p) dp -  \int_{\plower}^r p(1-F(p))^{n-1}f(p)dp
\\ \text{shoppers ($\mu$)} &: s = 0
\\ \text{search if} &: V_I > 0  
\\ \text{non-shoppers ($1-\mu$)} &: s \sim g(s); s \in [0,\bar{s}]; \text{ CDF } G(s)
\\ \text{search if} &: V_I - s_i \geq 0 
\\ \text{indifferent non-shopper} &: V_I - \tilde{s} = 0
\\ \text{implied informed share} &= \informed = \mu + (1-\mu)\cdot G(\tilde{s})
\end{align*}

\TK{is $V_I > 0$? shoppers always search; yes because random price can never be lower than lowest informed price}
